<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Docker最新超详细版教程通俗易懂(基础版) | 刘先森の博客</title><meta name="keywords" content="Docker"><meta name="author" content="刘先森"><meta name="copyright" content="刘先森"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Docker 学习重点！  Docker数据卷 Docker容器 Docker Compose Docker Swarm （类似于简化版的K8S） CI &#x2F; CD jenkins">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker最新超详细版教程通俗易懂(基础版)">
<meta property="og:url" content="http://hhliu.top/archives/10297.html">
<meta property="og:site_name" content="刘先森の博客">
<meta property="og:description" content="Docker 学习重点！  Docker数据卷 Docker容器 Docker Compose Docker Swarm （类似于简化版的K8S） CI &#x2F; CD jenkins">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/015.webp">
<meta property="article:published_time" content="2022-03-03T08:11:43.000Z">
<meta property="article:modified_time" content="2022-03-09T09:01:18.056Z">
<meta property="article:author" content="刘先森">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/015.webp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://hhliu.top/archives/10297"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="code-IxRylv4wqf"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":180,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":150},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 刘先森","link":"链接: ","source":"来源: 刘先森の博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Docker最新超详细版教程通俗易懂(基础版)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-03-09 17:01:18'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-clock/lib/clock.min.css" /><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/head.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">109</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">37</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标籤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw icon-tiger"></i><span> 拓展</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/comments/"><i class="fa-fw fa fa-comments"></i><span> 留言</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/015.webp')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">刘先森の博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标籤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw icon-tiger"></i><span> 拓展</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/comments/"><i class="fa-fw fa fa-comments"></i><span> 留言</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Docker最新超详细版教程通俗易懂(基础版)<a class="post-edit-link" href="null_posts/Docker最新超详细版教程通俗易懂-基础版.md" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-03-03T08:11:43.000Z" title="发表于 2022-03-03 16:11:43">2022-03-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-03-09T09:01:18.056Z" title="更新于 2022-03-09 17:01:18">2022-03-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Docker/">Docker</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">25k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>106分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Docker最新超详细版教程通俗易懂(基础版)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>Docker</p>
<p>学习重点！</p>
<ul>
<li>Docker数据卷</li>
<li>Docker容器</li>
<li>Docker Compose</li>
<li>Docker Swarm （类似于简化版的K8S）</li>
<li>CI / CD jenkins</li>
</ul>
<span id="more"></span>
<h2 id="一、Docker概述"><a href="#一、Docker概述" class="headerlink" title="一、Docker概述"></a>一、Docker概述</h2><h3 id="1-1-Docker为什么出现"><a href="#1-1-Docker为什么出现" class="headerlink" title="1.1 Docker为什么出现?"></a>1.1 Docker为什么出现?</h3><p>一款产品： 开发–上线 两套环境！应用环境，应用配置！</p>
<p>开发 — 运维。 问题：我在我的电脑上可以允许！版本更新，导致服务不可用！对于运维来说考验十分大？</p>
<p>环境配置是十分的麻烦，每一个机器都要部署环境(集群Redis、ES、Hadoop…) !费事费力。</p>
<p>发布一个项目( jar + (Redis MySQL JDK ES) )，项目能不能带上环境安装打包！</p>
<p>之前在服务器配置一个应用的环境 Redis、MySQL、JDK、ES、Hadoop 配置超麻烦了，不能够跨平台。开发环境Windows，最后发布到Linux！</p>
<p>传统：开发jar，运维来做！</p>
<p>现在：开发打包部署上线，一套流程做完！</p>
<p>安卓流程：java — apk —发布（应用商店）—- 张三使用apk一安装即可用！</p>
<p>docker流程： java-jar（环境） — 打包项目带上环境（镜像） — ( Docker仓库：商店）——-下载我们发布的镜像 —- 直接运行即可！</p>
<p>Docker给以上的问题，提出了解决方案！</p>
<p><img src="https://img-blog.csdnimg.cn/20210112222004427.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>Docker的思想就来自于集装箱！</p>
<p>JRE – 多个应用(端口冲突) – 原来都是交叉的！</p>
<p>隔离：Docker核心思想！打包装箱！每个箱子是互相隔离的。</p>
<p>Docker通过隔离机制，可以将服务器利用到极致！</p>
<p>本质：所有的技术都是因为出现了一些问题，我们需要去解决，才去学习！</p>
<h3 id="1-2-Docker的历史"><a href="#1-2-Docker的历史" class="headerlink" title="1.2 Docker的历史"></a>1.2 Docker的历史</h3><p>2010年，几个搞IT的年轻人，就在美国成立了一家公司 dotcloud</p>
<p>做一些 pass 的云计算服务！LXC（Linux Container容器）有关的容器技术！</p>
<ul>
<li>Linux Container容器是一种内核虚拟化技术，可以提供轻量级的虚拟化，以便隔离进程和资源。</li>
</ul>
<p>他们将自己的技术（容器化技术）命名就是 Docker。</p>
<p>Docker刚刚延生的时候，没有引起行业的注意！dotCloud，就活不下去！</p>
<ul>
<li>开源</li>
</ul>
<p>2013年，Docker开源！</p>
<p>越来越多的人发现docker的优点！火了。Docker每个月都会更新一个版本！</p>
<p>2014年4月9日，Docker1.0发布！</p>
<p><strong>docker为什么这么火？</strong>十分的轻巧！</p>
<p>在容器技术出来之前，我们都是使用虚拟机技术！</p>
<p>虚拟机：在window中装一个VMware，通过这个软件我们可以虚拟出来一台或者多台电脑！笨重！</p>
<p>虚拟机也属于虚拟化技术，Docker容器技术，也是一种虚拟化技术！</p>
<ul>
<li>vm : linux centos 原生镜像（一个电脑！） 隔离、需要开启多个虚拟机！ 几个G 几分钟</li>
<li>docker: 隔离，镜像（最核心的环境 4m + jdk + mysql）十分的小巧，运行镜像就可以了！小巧！<br>几个M 秒级启动！</li>
</ul>
<p>Docker基于Go语言开发的！开源项目！</p>
<p>docker官网：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.docker.com/">https://www.docker.com/</a></p>
<p>文档：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.docker.com/">https://docs.docker.com/</a> Docker的文档是超级详细的！</p>
<p>仓库：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://hub.docker.com/">https://hub.docker.com/</a> 相当于 github</p>
<h3 id="1-3-Docker能做什么？"><a href="#1-3-Docker能做什么？" class="headerlink" title="1.3 Docker能做什么？"></a>1.3 Docker能做什么？</h3><p>比较Docker和虚拟机技术的不同：</p>
<ul>
<li>传统虚拟机，虚拟出一条硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件</li>
<li>容器内的应用直接运行在宿主机的内容，容器是没有自己的内核的，也没有虚拟我们的硬件，所以<br>就轻便了</li>
<li>每个容器间是互相隔离，每个容器内都有一个属于自己的文件系统，互不影响</li>
</ul>
<h3 id="1-4-DevOps-开发、运维"><a href="#1-4-DevOps-开发、运维" class="headerlink" title="1.4 DevOps(开发、运维)"></a>1.4 DevOps(开发、运维)</h3><ul>
<li>应用更快速的交付和部署</li>
</ul>
<p>传统：一对帮助文档，安装程序。</p>
<p>Docker：打包镜像发布测试一键运行。</p>
<ul>
<li>更便捷的升级和扩缩容</li>
</ul>
<p>使用了 Docker之后，我们部署应用就和搭积木一样</p>
<p>项目打包为一个镜像，扩展服务器A！服务器B</p>
<ul>
<li>更简单的系统运维</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在容器化之后，我们的开发，测试环境都是高度一致的</span><br></pre></td></tr></table></figure>
<ul>
<li>更高效的计算资源利用</li>
</ul>
<p>Docker是内核级别的虚拟化，可以在一个物理机上可以运行很多的容器实例！服务器的性能可以被压榨<br>到极致。</p>
<h2 id="二、安装"><a href="#二、安装" class="headerlink" title="二、安装"></a>二、安装</h2><h3 id="2-1-Docker的基本组成"><a href="#2-1-Docker的基本组成" class="headerlink" title="2.1 Docker的基本组成"></a>2.1 Docker的基本组成</h3><p><img src="https://img-blog.csdnimg.cn/20210112223441225.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>一个是Docker的客户端，一个是Docker的主机，一个是Docker的远程仓库：</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211129191107734.png" alt="image-20211129191107734"></p>
<p>构建完之后，我们需要去运行,运行是在docker的服务上面去运行的  ，Docker的守护进程中去运行，首先去镜像中去运行，这个镜像好比是一个Java类模板，运行的时候会产生很多的对象，这些一个个的对象就是我们的镜像</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211129191214657.png" alt="image-20211129191214657"></p>
<ul>
<li>镜像（image)：</li>
</ul>
<p>docker镜像就好比是一个目标，可以通过这个目标来创建容器服务，tomcat镜像==&gt;run==&gt;容器（提供服务器），通过这个镜像可以创建多个容器（最终服务运行或者项目运行就是在容器中的）。</p>
<ul>
<li>容器(container)：</li>
</ul>
<p>Docker利用容器技术，独立运行一个或者一组应用，通过镜像来创建的.</p>
<p>启动，停止，删除，基本命令</p>
<p>目前就可以把这个容器理解为就是一个简易的 Linux系统。</p>
<ul>
<li>仓库(repository)：</li>
</ul>
<p>仓库就是存放镜像的地方！</p>
<p>仓库分为公有仓库和私有仓库。(很类似git)</p>
<p>Docker Hub是国外的。</p>
<p>阿里云…都有容器服务器(配置镜像加速!)</p>
<h3 id="2-2-安装Docker"><a href="#2-2-安装Docker" class="headerlink" title="2.2 安装Docker"></a>2.2 安装Docker</h3><p>环境准备</p>
<p>Linux要求内核3.0以上</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">linux内核</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# uname -r</span><br><span class="line">4.18.0-80.11.2.el8_0.x86_64</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">linux系统版本</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# cat /etc/os-release </span><br><span class="line">NAME=&quot;CentOS Linux&quot;</span><br><span class="line">VERSION=&quot;8 (Core)&quot;</span><br><span class="line">ID=&quot;centos&quot;</span><br><span class="line">ID_LIKE=&quot;rhel fedora&quot;</span><br><span class="line">VERSION_ID=&quot;8&quot;</span><br><span class="line">PLATFORM_ID=&quot;platform:el8&quot;</span><br><span class="line">PRETTY_NAME=&quot;CentOS Linux 8 (Core)&quot;</span><br><span class="line">ANSI_COLOR=&quot;0;31&quot;</span><br><span class="line">CPE_NAME=&quot;cpe:/o:centos:centos:8&quot;</span><br><span class="line">HOME_URL=&quot;https://www.centos.org/&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;https://bugs.centos.org/&quot;</span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=&quot;CentOS-8&quot;</span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=&quot;8&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT=&quot;centos&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=&quot;8&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>安装</li>
</ul>
<p>帮助文档：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.docker.com/engine/install/">https://docs.docker.com/engine/install/</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">1.卸载旧的版本</span></span><br><span class="line">yum remove docker \</span><br><span class="line">    docker-client \</span><br><span class="line">    docker-client-latest \</span><br><span class="line">    docker-common \</span><br><span class="line">    docker-latest \</span><br><span class="line">    docker-latest-logrotate \</span><br><span class="line">    docker-logrotate \</span><br><span class="line">    docker-engine</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">2.需要的安装包</span></span><br><span class="line">yum install -y yum-utils</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">3.设置镜像仓库</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo #默认是从国外的，不推荐</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">推荐使用国内的</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta">#</span><span class="language-bash">更新yum软件包索引</span></span><br><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">4.安装docker相关的 docker-ce 社区版 而ee是企业版</span></span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>
<p>此时如果执行    <code>yum makecache fast出错的</code></p>
<p>解决方法：</p>
<p>1.进入/etc/yum.repos.d</p>
<p> cd /etc/yum.repos.d</p>
<p>2.删除相应文件，文件名称对应错误提示中的名称，如：</p>
<p><img src="https://img2020.cnblogs.com/blog/1060802/202011/1060802-20201104220517510-64681759.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">5.启动docker</span></span><br><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">6. 使用docker version查看是否按照成功</span></span><br><span class="line">docker version</span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           20.10.11</span><br><span class="line"> API version:       1.41</span><br><span class="line"> Go version:        go1.16.9</span><br><span class="line"> Git commit:        dea9396</span><br><span class="line"> Built:             Thu Nov 18 00:36:58 2021</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      true</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          20.10.11</span><br><span class="line">  API version:      1.41 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.16.9</span><br><span class="line">  Git commit:       847da18</span><br><span class="line">  Built:            Thu Nov 18 00:35:20 2021</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.4.12</span><br><span class="line">  GitCommit:        7b11cfaabd73bb80907dd23182b9347b4245eb5d</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.2</span><br><span class="line">  GitCommit:        v1.0.2-0-g52b36a2</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.19.0</span><br><span class="line">  GitCommit:        de40ad0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">7. 测试</span></span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">8.查看一下下载的这个hello-world镜像</span></span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>
<p>了解：卸载Docker</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">1. 卸载依赖</span></span><br><span class="line">yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="meta">#</span><span class="language-bash">2. 删除资源</span></span><br><span class="line">rm -rf /var/lib/docker</span><br><span class="line"><span class="meta"># </span><span class="language-bash">/var/lib/docker 是docker的默认工作路径！</span></span><br></pre></td></tr></table></figure>
<h3 id="2-3-阿里云镜像加速"><a href="#2-3-阿里云镜像加速" class="headerlink" title="2.3 阿里云镜像加速"></a>2.3 阿里云镜像加速</h3><p>1、登录阿里云找到容器服务<br>        2、找到镜像加速器</p>
<p><img src="https://img-blog.csdnimg.cn/20210718152430680.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>3、配置使用</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://78q96cy9.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
<p>回顾HelloWorld流程:</p>
<p><img src="https://img-blog.csdnimg.cn/2021071908571839.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="2-4-底层原理"><a href="#2-4-底层原理" class="headerlink" title="2.4 底层原理"></a>2.4 底层原理</h3><p>Docker是怎么工作的？</p>
<p>Docker是一个Client-Server结构的系统，Docker的守护进程运行在主机上。通过Socket从客户端访<br>问！</p>
<p>Docker-Server接收到Docker-Client的指令，就会执行这个命令！</p>
<p><img src="https://img-blog.csdnimg.cn/20210719092624997.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>Docker为什么比VM快？</strong></p>
<p>1、Dokcer有着比虚拟机更少的抽象层。由于docker不需要Hypervisor实现硬件资源虚拟化,运行在docker容器上的程序直接使用的都是实际物理机的硬件资源。因此在CPU、内存利用率上docker将会在效率上有明显优势。</p>
<p>2、docker利用的是宿主机的内核，vm 需要是Guest OS</p>
<p><img src="https://img-blog.csdnimg.cn/20210719100837873.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>所以说，新建一个容器的时候，docker 不需要像虚拟机一样重新加载一个操作系统内核，避免引导。虚拟机是加载 Guest OS，分钟级别的，而docker 是利用宿主机的操作系统，省略了这个复杂的过程，秒级！</p>
<p><img src="https://img-blog.csdnimg.cn/20210719104158225.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="三、Docker常用命令"><a href="#三、Docker常用命令" class="headerlink" title="三、Docker常用命令"></a>三、Docker常用命令</h2><h3 id="3-1-帮助命令"><a href="#3-1-帮助命令" class="headerlink" title="3.1 帮助命令"></a>3.1 帮助命令</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker version #显示docker的版本信息。</span><br><span class="line">docker info #显示docker的系统信息，包括镜像和容器的数量</span><br><span class="line">docker 命令 --help #帮助命令</span><br></pre></td></tr></table></figure>
<p>帮助文档的地址：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.docker.com/engine/reference/commandline/docker/">https://docs.docker.com/engine/reference/commandline/docker/</a></p>
<h3 id="3-2-镜像命令"><a href="#3-2-镜像命令" class="headerlink" title="3.2 镜像命令"></a>3.2 镜像命令</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker images #查看所有本地主机上的镜像 可以使用docker image ls代替</span><br><span class="line">docker search 搜索镜像</span><br><span class="line">docker pull 下载镜像 docker image pull</span><br><span class="line">docker rmi 删除镜像 docker image rm</span><br></pre></td></tr></table></figure>
<p><strong>docker images</strong> 查看所有本地的主机上的镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">docker images</span></span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">hello-world   latest    d1165f221234   4 months ago   13.3kB</span><br><span class="line"><span class="meta"># </span><span class="language-bash">解释</span></span><br><span class="line">REPOSITORY   镜像的仓库源</span><br><span class="line">TAG          镜像的标签</span><br><span class="line">IMAGE ID     镜像的ID</span><br><span class="line">CREATED      镜像的创建时间</span><br><span class="line">SIZE         镜像的大小</span><br><span class="line"><span class="meta"># </span><span class="language-bash">可选项</span></span><br><span class="line">  -a, --all             # 列出所有的镜像</span><br><span class="line">  -q, --quiet           # 只显示镜像的id</span><br><span class="line">docker images -aq ＃显示所有镜像的id</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">docker search mysql</span></span><br><span class="line">NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql                             MySQL is a widely used, open-source relation…   11138     [OK]       </span><br><span class="line">mariadb                           MariaDB Server is a high performing open sou…   4221      [OK]       </span><br><span class="line">mysql/mysql-server                Optimized MySQL Server Docker images. Create…   829                  [OK]</span><br><span class="line">percona                           Percona Server is a fork of the MySQL relati…   547       [OK]       </span><br><span class="line">phpmyadmin                        phpMyAdmin - A web interface for MySQL and M…   274       [OK]       </span><br><span class="line">centos/mysql-57-centos7           MySQL 5.7 SQL database server                   89                   </span><br><span class="line">mysql/mysql-cluster               Experimental MySQL Cluster Docker images. Cr…   88   </span><br><span class="line"><span class="meta"># </span><span class="language-bash">可选项</span></span><br><span class="line">--filter=STARS=3000   # 搜索出来的镜像就死starts 大于3000的</span><br><span class="line"><span class="meta"># </span><span class="language-bash">docker search mysql --filter=STARS=3000</span></span><br><span class="line">NAME      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql     MySQL is a widely used, open-source relation…   11138     [OK]       </span><br><span class="line">mariadb   MariaDB Server is a high performing open sou…   4221      [OK]</span><br></pre></td></tr></table></figure>
<p><strong>docker pull 下载镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">下载镜像 docker pull 镜像名[:tag]</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">docker pull mysql</span></span><br><span class="line">Using default tag: latest #如果不写tag的话，默认使用的就是latest</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">b4d181a07f80: Pull complete   # 分层下载，docker images核心  联合文件系统</span><br><span class="line">a462b60610f5: Pull complete </span><br><span class="line">578fafb77ab8: Pull complete </span><br><span class="line">524046006037: Pull complete </span><br><span class="line">d0cbe54c8855: Pull complete </span><br><span class="line">aa18e05cc46d: Pull complete </span><br><span class="line">32ca814c833f: Pull complete </span><br><span class="line">9ecc8abdb7f5: Pull complete </span><br><span class="line">ad042b682e0f: Pull complete </span><br><span class="line">71d327c6bb78: Pull complete </span><br><span class="line">165d1d10a3fa: Pull complete </span><br><span class="line">2f40c47d0626: Pull complete </span><br><span class="line">Digest: sha256:52b8406e4c32b8cf0557f1b74517e14c5393aff5cf0384eff62d9e81f4985d4b   #签名</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">docker.io/library/mysql:latest  #真实地址</span><br><span class="line"><span class="meta"># </span><span class="language-bash">等价于</span></span><br><span class="line">docker pull mysql</span><br><span class="line">docker pull docker.io/library/mysql:latest</span><br><span class="line"><span class="meta"># </span><span class="language-bash">指定版本下载</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">docker pull mysql:5.7</span></span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">b4d181a07f80: Already exists </span><br><span class="line">a462b60610f5: Already exists </span><br><span class="line">578fafb77ab8: Already exists </span><br><span class="line">524046006037: Already exists </span><br><span class="line">d0cbe54c8855: Already exists </span><br><span class="line">aa18e05cc46d: Already exists </span><br><span class="line">32ca814c833f: Already exists </span><br><span class="line">52645b4af634: Pull complete </span><br><span class="line">bca6a5b14385: Pull complete </span><br><span class="line">309f36297c75: Pull complete </span><br><span class="line">7d75cacde0f8: Pull complete </span><br><span class="line">Digest: sha256:1a2f9cd257e75cc80e9118b303d1648366bc2049101449bf2c8d82b022ea86b7</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br></pre></td></tr></table></figure>
<p><strong>docker rmi 删除镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">docker rmi -f 镜像<span class="built_in">id</span>         <span class="comment"># 删除指定的镜像</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">docker rmi -f 镜像<span class="built_in">id</span> 镜像<span class="built_in">id</span> 镜像<span class="built_in">id</span> 镜像<span class="built_in">id</span>   <span class="comment"># 删除多个镜像</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">docker rmi -f $(docker images -aq)     <span class="comment"># 删除全部的镜像</span></span></span><br></pre></td></tr></table></figure>
<h3 id="3-3、容器命令"><a href="#3-3、容器命令" class="headerlink" title="3.3、容器命令"></a>3.3、容器命令</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run 镜像id 新建容器并启动</span><br><span class="line">docker ps 列出所有运行的容器 docker container list</span><br><span class="line">docker rm 容器id 删除指定容器</span><br><span class="line">docker start 容器id #启动容器</span><br><span class="line">docker restart容器id #重启容器</span><br><span class="line">docker stop 容器id #停止当前正在运行的容器</span><br><span class="line">docker kill 容器id #强制停止当前容器</span><br></pre></td></tr></table></figure>
<p>说明：我们有了镜像才可以创建容器，linux，下载一个centos镜像来测试学习</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211129205120509.png" alt="image-20211129205120509"></p>
<p>新建容器并启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run [可选参数] image</span><br><span class="line"><span class="meta"># </span><span class="language-bash">参数说明</span></span><br><span class="line">--name=&quot;Name&quot;     容器名字   tomcat01   tomcat02，  用来区分容器</span><br><span class="line">-d                后台方式运行  java常用的nohup</span><br><span class="line">-it               使用交互方式运行，进入容器查看内容</span><br><span class="line">-p                指定容器的端口 -p  8080:8080</span><br><span class="line">    -p   ip:主机端口:容器端口</span><br><span class="line">    -p   主机端口:容器端口（常用）</span><br><span class="line">    -p   容器端口</span><br><span class="line">    容器端口</span><br><span class="line">-p                随机指定端口</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker run -it centos /bin/bash</span><br><span class="line">runc: symbol lookup error: runc: undefined symbol: seccomp_api_get</span><br><span class="line">docker: Error response from daemon: cannot start a stopped process: unknown.</span><br></pre></td></tr></table></figure>
<p>直接运行的时候，我们有时候可能会出现错误，此时我们需要新增一下依赖即可。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install libseccomp-devel</span><br></pre></td></tr></table></figure>
<p>然后重新运行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">测试，启动并进入容器</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@460839d39a28 /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></table></figure>
<p>我们此时发现，我们的主机名称发生了一些变化，新的这个主机名称，也就是我们的镜像的id:</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211129210251183.png" alt="image-20211129210251183"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">从容器中退回主机</span></span><br><span class="line">[root@460839d39a28 /]# exit</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211129210520722.png" alt="image-20211129210520722"></p>
<p><strong>列出所有的运行的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">docker ps命令 <span class="comment">#列出当前正在运行的容器</span></span></span><br><span class="line">    # 列出当前正在运行的容器</span><br><span class="line">-a  # 列出当前正在运行的容器+带出历史运行过的容器</span><br><span class="line">-n=? # 显示最近创建的容器</span><br><span class="line">-q  # 只显示容器的编号</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">列出当前正在运行的容器</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"><span class="meta">#</span><span class="language-bash">列出所有正在运行的容器包含历史运行过的容器</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED          STATUS                       PORTS     NAMES</span><br><span class="line">460839d39a28   centos         &quot;/bin/bash&quot;   6 minutes ago    Exited (127) 2 minutes ago             peaceful_mestorf</span><br><span class="line">cbe729c88d10   centos         &quot;/bin/bash&quot;   6 minutes ago    Created                                dreamy_agnesi</span><br><span class="line">185965df630e   centos         &quot;/bin/bash&quot;   7 minutes ago    Created                                friendly_davinci</span><br><span class="line">127e09783e48   feb5d9fea6a5   &quot;/hello&quot;      57 minutes ago   Created                                hardcore_black</span><br></pre></td></tr></table></figure>
<p><strong>退出容器</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">exit    # 直接容器停止并退出</span><br><span class="line">Ctrl + P + Q # 容器不停止退出</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@1bdee0b9ffdd /]# docker ps[root@iZuf65oftugvcjgk2jncyeZ /]# clear</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED              STATUS              PORTS     NAMES</span><br><span class="line">1bdee0b9ffdd   centos    &quot;/bin/bash&quot;   About a minute ago   Up About a minute             hardcore_khayyam</span><br></pre></td></tr></table></figure>
<p>此时我们发现，即使我们退出了容器，但是容器还是在后台运行的</p>
<p><strong>删除容器</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker rm 容器id     # 删除指定容器，不能删除正在运行的容器，如果要强制删除  rm -f</span><br><span class="line">docker rm -f $(docker ps -aq)  # 删除所有的容器</span><br><span class="line">docker ps -a -q | xargs docker rm  # 删除所有的容器</span><br></pre></td></tr></table></figure>
<p><strong>启动和停止容器的操作</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker start 容器id     #启动容器</span><br><span class="line">docker restart 容器id  #重启容器</span><br><span class="line">docker stop 容器id      #停止当前正在运行的容器</span><br><span class="line">docker kill 容器id      #强制停止当前容器</span><br></pre></td></tr></table></figure>
<h3 id="3-4、常用其他命令"><a href="#3-4、常用其他命令" class="headerlink" title="3.4、常用其他命令"></a>3.4、常用其他命令</h3><h4 id="3-4-1-后台启动容器"><a href="#3-4-1-后台启动容器" class="headerlink" title="3.4.1 后台启动容器:"></a>3.4.1 后台启动容器:</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">命令 docker  run -d 镜像名！</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker run -d centos</span><br><span class="line">6628b8a4eb5562a96213da7e58444554ef0cbf94b717df526072d1cc888812cb</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"><span class="meta"># </span><span class="language-bash">问题docker  ps，发现centos停止了</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">常见的坑，docker 容器使用后台运行，就必须要有一个前台进程， docker 发现没有应用，就会自动停止</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">nginx，容器启动后，发现自己没有提供服务，就会立刻停止，就是没有程序了</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-2-查看日志"><a href="#3-4-2-查看日志" class="headerlink" title="3.4.2 查看日志"></a>3.4.2 <strong>查看日志</strong></h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker logs --help</span><br><span class="line"></span><br><span class="line">Usage:  docker logs [OPTIONS] CONTAINER</span><br><span class="line"></span><br><span class="line">Fetch the logs of a container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --details        Show extra details provided to logs</span><br><span class="line">  -f, --follow         Follow log output</span><br><span class="line">      --since string   Show logs since timestamp (e.g. 2013-01-02T13:23:37Z) or relative (e.g. 42m for 42 minutes)</span><br><span class="line">  -n, --tail string    Number of lines to show from the end of the logs (default &quot;all&quot;)</span><br><span class="line">  -t, --timestamps     Show timestamps</span><br><span class="line">      --until string   Show logs before a timestamp (e.g. 2013-01-02T13:23:37Z) or relative (e.g. 42m for 42 minutes)</span><br><span class="line"></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker logs --tf --tail 10 </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">自己编写一段shell脚本</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker run -d mysql -c &quot;while true;do echo 666;sleep 1;done;&quot;</span><br><span class="line">41d294333ac2df9b6441f11c467af1c346ed2d243d9a5b02f649318b376c54da</span><br><span class="line"></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line">b1177469c5ce   centos    &quot;/bin/bash -c &#x27;while…&quot;   32 seconds ago   Up 31 seconds             stoic_rubin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">显示日志</span></span><br><span class="line">-tf        #显示日志</span><br><span class="line">--tail=number     #要显示日志条数</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker logs -tf --tail 10 b1177469c5ce</span><br><span class="line">2021-11-30T05:36:35.119212478Z 666</span><br><span class="line">2021-11-30T05:36:36.121208677Z 666</span><br><span class="line">2021-11-30T05:36:37.123249288Z 666</span><br><span class="line">2021-11-30T05:36:38.125155628Z 666</span><br><span class="line">2021-11-30T05:36:39.127012899Z 666</span><br><span class="line">2021-11-30T05:36:40.128800099Z 666</span><br><span class="line">2021-11-30T05:36:41.130658457Z 666</span><br><span class="line">2021-11-30T05:36:42.132566895Z 666</span><br><span class="line">2021-11-30T05:36:43.134436292Z 666</span><br><span class="line">2021-11-30T05:36:44.136354825Z 666</span><br><span class="line">2021-11-30T05:36:45.138181418Z 666</span><br><span class="line">2021-11-30T05:36:46.140294276Z 666</span><br><span class="line">2021-11-30T05:36:47.142204299Z 666</span><br></pre></td></tr></table></figure>
<h4 id="3-4-3-查看容器中进程信息-ps"><a href="#3-4-3-查看容器中进程信息-ps" class="headerlink" title="3.4.3 查看容器中进程信息 ps"></a><strong>3.4.3 查看容器中进程信息 ps</strong></h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">命令 docker top 容器<span class="built_in">id</span></span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker top b1177469c5ce</span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                44214               44195               0                   13:35               ?                   00:00:00            /bin/bash -c while true;do echo 666;sleep 1;done;</span><br><span class="line">root                44419               44214               0                   13:38               ?                   00:00:00            /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 1</span><br></pre></td></tr></table></figure>
<h4 id="3-4-4-查看镜像的元数据"><a href="#3-4-4-查看镜像的元数据" class="headerlink" title="3.4.4 查看镜像的元数据"></a>3.4.4 <strong>查看镜像的元数据</strong></h4><p>我们想要具体的去了解这个镜像里面到底有一些什么东西</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">命令</span></span><br><span class="line">docker inspect 容器id</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker inspect b1177469c5ce</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;b1177469c5ce2c4dfe615b0291afbb9fcf02c9c8ab7ab47bc0e299a00bb38035&quot;,    #我们的显示的docker镜像id只是实际的id的前面部分</span><br><span class="line">        &quot;Created&quot;: &quot;2021-11-30T05:35:53.708359857Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/bash&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;-c&quot;,</span><br><span class="line">            &quot;while true;do echo 666;sleep 1;done;&quot;   #循环执行的脚本</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 44214,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2021-11-30T05:35:54.029745023Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:5d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/b1177469c5ce2c4dfe615b0291afbb9fcf02c9c8ab7ab47bc0e299a00bb38035/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/b1177469c5ce2c4dfe615b0291afbb9fcf02c9c8ab7ab47bc0e299a00bb38035/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/b1177469c5ce2c4dfe615b0291afbb9fcf02c9c8ab7ab47bc0e299a00bb38035/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/b1177469c5ce2c4dfe615b0291afbb9fcf02c9c8ab7ab47bc0e299a00bb38035/b1177469c5ce2c4dfe615b0291afbb9fcf02c9c8ab7ab47bc0e299a00bb38035-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/stoic_rubin&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;CgroupnsMode&quot;: &quot;host&quot;,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/28611847bb66c75b582935c3a2cca2dbfeea7eabf7d6a8e0da30388c39deebc6-init/diff:/var/lib/docker/overlay2/70adc9441b28ca6f085201c6718aec46939adcf4f6923a61974653c08e0bbe54/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/28611847bb66c75b582935c3a2cca2dbfeea7eabf7d6a8e0da30388c39deebc6/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/28611847bb66c75b582935c3a2cca2dbfeea7eabf7d6a8e0da30388c39deebc6/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/28611847bb66c75b582935c3a2cca2dbfeea7eabf7d6a8e0da30388c39deebc6/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;b1177469c5ce&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/bash&quot;,</span><br><span class="line">                &quot;-c&quot;,</span><br><span class="line">                &quot;while true;do echo 666;sleep 1;done;&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;centos&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20210915&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;533c33305e4f20427ea415128fdc117e7888addc50f8dd3c02fff85413614892&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;&#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/533c33305e4f&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;a960b772e6ce24aaf872de835ff2d8b82ee439a7364b28d66884b1bbf4377104&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;54e8f3e9829b70b9677cd07b5fddc1a5cc45614885f9ee0037bb80785da84f91&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;a960b772e6ce24aaf872de835ff2d8b82ee439a7364b28d66884b1bbf4377104&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="3-4-5-进入当前正在运行的容器"><a href="#3-4-5-进入当前正在运行的容器" class="headerlink" title="3.4.5 进入当前正在运行的容器"></a>3.4.5 <strong>进入当前正在运行的容器</strong></h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">我们通常容器都是使用后台方式运行的，需要进入容器，修改一些配置</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">命令</span></span><br><span class="line">docker exec -it 容器id bashShell</span><br><span class="line"><span class="meta"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker exec -it b1177469c5ce /bin/bash</span><br><span class="line">[root@b1177469c5ce /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@b1177469c5ce /]# ps -ef</span><br><span class="line">UID          PID    PPID  C STIME TTY          TIME CMD</span><br><span class="line">root           1       0  0 05:35 ?        00:00:00 /bin/bash -c while true;do echo 666;sleep 1;done;</span><br><span class="line">root         654       0  0 05:46 pts/0    00:00:00 /bin/bash</span><br><span class="line">root         674       1  0 05:46 ?        00:00:00 /usr/bin/coreutils --coreutils-prog-shebang=sleep /usr/bin/sleep 1</span><br><span class="line">root         675     654  0 05:46 pts/0    00:00:00 ps -ef</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">方式二</span></span><br><span class="line">docker attach 容器id</span><br><span class="line"><span class="meta"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker attach 596b80f933ac</span><br><span class="line">666</span><br><span class="line">666</span><br><span class="line">666</span><br><span class="line">。。。。一直在执行刚刚我们创建的那个脚本	</span><br><span class="line"><span class="meta"># </span><span class="language-bash">docker <span class="built_in">exec</span>    <span class="comment">#进入容器后开启一个新的终端，可以在里面操作（常用）</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">docker attach  <span class="comment">#进入容器正在执行的终端，不会启动新的进程！</span></span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-6-从容器内拷贝到主机上"><a href="#3-4-6-从容器内拷贝到主机上" class="headerlink" title="3.4.6 从容器内拷贝到主机上"></a>3.4.6 <strong>从容器内拷贝到主机上</strong></h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker cp 容器id:容器内路径   目的的主机路径</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看当前主机目录下</span></span><br><span class="line">root@iZuf65oftugvcjgk2jncyeZ ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@7020acf78fbd /]# [root@iZuf65oftugvcjgk2jncyeZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS         PORTS     NAMES</span><br><span class="line">7020acf78fbd   centos    &quot;/bin/bash&quot;   7 seconds ago   Up 6 seconds             quizzical_austin</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker exec -it 7020acf78fbd /bin/bash</span><br><span class="line">[root@7020acf78fbd /]# ls </span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@7020acf78fbd /]# cd home </span><br><span class="line">[root@7020acf78fbd home]# ls</span><br><span class="line"><span class="meta">#</span><span class="language-bash">在容器内部新建一个md文件，然后准备在容器外部，将此文件拷贝出来</span></span><br><span class="line">[root@7020acf78fbd home]# touch test.md</span><br><span class="line">[root@7020acf78fbd home]# ls</span><br><span class="line">test.md</span><br><span class="line"></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker cp 7020acf78fbd:/home/test.md /home</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# ls</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# cd home</span><br><span class="line">-bash: cd: home: No such file or directory</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# ls</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# cd /home</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ home]# ls</span><br><span class="line">test.md</span><br><span class="line"><span class="meta"># </span><span class="language-bash">拷贝是一个手动过程，未来我们使用 -v 卷的技术，可以实现数据的自动同步 可以实现镜像的home目录和我们的主机的home目录联通</span></span><br></pre></td></tr></table></figure>
<h2 id="四、小结"><a href="#四、小结" class="headerlink" title="四、小结"></a>四、小结</h2><p><img src="https://img-blog.csdnimg.cn/20210720092439814.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>命令</th>
<th>en</th>
<th>ch</th>
</tr>
</thead>
<tbody>
<tr>
<td>attach</td>
<td>Attach to a running container</td>
<td>当前shell下attach连接指定运行镜像  但是只会进入默认的执行的终端</td>
</tr>
<tr>
<td>build</td>
<td>Build an image from a Dockerfile</td>
<td>通过Dockerfile定制镜像</td>
</tr>
<tr>
<td>commit</td>
<td>Create a new image from a containers changes</td>
<td>提交当前容器为新的镜像</td>
</tr>
<tr>
<td>cp</td>
<td>Copy files/folders from a container to a HOSTDIR or to STDOUT</td>
<td>从容器中拷贝指定文件或者目录到宿主机中</td>
</tr>
<tr>
<td>create</td>
<td>Create a new container</td>
<td>创建一个新的容器，同run 但不启动容器</td>
</tr>
<tr>
<td>diff</td>
<td>Inspect changes on a containers filesystem</td>
<td>查看docker容器变化</td>
</tr>
<tr>
<td>events</td>
<td>Get real time events from the server</td>
<td>从docker服务获取容器实时事件</td>
</tr>
<tr>
<td>exec</td>
<td>Run a command in a running container</td>
<td>在已存在的容器上运行命令</td>
</tr>
<tr>
<td>export</td>
<td>Export a containers filesystem as a tar archive</td>
<td>导出容器的内容流作为一个tar归档文件(对应import)</td>
</tr>
<tr>
<td>history</td>
<td>Show the history of an image</td>
<td>展示一个镜像形成历史</td>
</tr>
<tr>
<td>images</td>
<td>List images</td>
<td>列出系统当前镜像</td>
</tr>
<tr>
<td>import</td>
<td>Import the contents from a tarball to create a filesystem image</td>
<td>从tar包中的内容创建一个新的文件系统映像(对应export)</td>
</tr>
<tr>
<td>info</td>
<td>Display system-wide information</td>
<td>显示系统相关信息</td>
</tr>
<tr>
<td>inspect</td>
<td>Return low-level information on a container or image</td>
<td>查看容器详细信息</td>
</tr>
<tr>
<td>kill</td>
<td>Kill a running container</td>
<td>kill指定docker容器</td>
</tr>
<tr>
<td>load</td>
<td>Load an image from a tar archive or STDIN</td>
<td>从一个tar包中加载一个镜像(对应save)</td>
</tr>
<tr>
<td>login</td>
<td>Register or log in to a Docker registry</td>
<td>注册或者登陆一个docker源服务器</td>
</tr>
<tr>
<td>logout</td>
<td>Log out from a Docker registry</td>
<td>从当前Docker registry退出</td>
</tr>
<tr>
<td>logs</td>
<td>Fetch the logs of a container</td>
<td>输出当前容器日志信息</td>
</tr>
<tr>
<td>pause</td>
<td>Pause all processes within a container</td>
<td>暂停容器</td>
</tr>
<tr>
<td>port</td>
<td>List port mappings or a specific mapping for the CONTAINER</td>
<td>查看映射端口对应的容器内部源端口</td>
</tr>
<tr>
<td>ps</td>
<td>List containers</td>
<td>列出容器列表</td>
</tr>
<tr>
<td>pull</td>
<td>Pull an image or a repository from a registry</td>
<td>从docker镜像源服务器拉取指定镜像或者库镜像</td>
</tr>
<tr>
<td>push</td>
<td>Push an image or a repository to a registry</td>
<td>推送指定镜像或者库镜像至docker源服务器</td>
</tr>
<tr>
<td>rename</td>
<td>Rename a container</td>
<td>重命名容器</td>
</tr>
<tr>
<td>restart</td>
<td>Restart a running container</td>
<td>重启运行的容器</td>
</tr>
<tr>
<td>rm</td>
<td>Remove one or more containers</td>
<td>移除一个或者多个容器</td>
</tr>
<tr>
<td>rmi</td>
<td>Remove one or more images</td>
<td>移除一个或多个镜像(无容器使用该镜像才可以删除，否则需要删除相关容器才可以继续或者-f强制删除)</td>
</tr>
<tr>
<td>run</td>
<td>Run a command in a new container</td>
<td>创建一个新的容器并运行一个命令</td>
</tr>
<tr>
<td>save</td>
<td>Save an image(s) to a tar archive</td>
<td>保存一个镜像为一个tar包(对应load)</td>
</tr>
<tr>
<td>search</td>
<td>Search the Docker Hub for images</td>
<td>在docker hub中搜索镜像</td>
</tr>
<tr>
<td>start</td>
<td>Start one or more stopped containers</td>
<td>启动容器</td>
</tr>
<tr>
<td>stats</td>
<td>Display a live stream of container(s) resource usage statistics</td>
<td>统计容器使用资源</td>
</tr>
<tr>
<td>stop</td>
<td>Stop a running container</td>
<td>停止容器</td>
</tr>
<tr>
<td>tag</td>
<td>Tag an image into a repository</td>
<td>给源中镜像打标签</td>
</tr>
<tr>
<td>top</td>
<td>Display the running processes of a container</td>
<td>查看容器中运行的进程信息</td>
</tr>
<tr>
<td>unpause</td>
<td>Unpause all processes within a container</td>
<td>取消暂停容器</td>
</tr>
<tr>
<td>version</td>
<td>Show the Docker version information</td>
<td>查看容器版本号</td>
</tr>
<tr>
<td>wait</td>
<td>Block until a container stops, then print its exit code</td>
<td>截取容器停止时的退出状态值</td>
</tr>
</tbody>
</table>
</div>
<h2 id="五、练习"><a href="#五、练习" class="headerlink" title="五、练习"></a>五、练习</h2><h3 id="5-1安装nginx"><a href="#5-1安装nginx" class="headerlink" title="5.1安装nginx"></a>5.1<strong>安装nginx</strong></h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="language-bash">1. 搜索镜像 search 建议大家去docker hub搜索，可以看到帮助文档</span></span><br><span class="line">docker search nginx</span><br><span class="line"><span class="meta">#</span><span class="language-bash">2. 拉取镜像 pull</span></span><br><span class="line">docker pull nginx</span><br><span class="line"><span class="meta">#</span><span class="language-bash">3. 运行测试</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">-d 后台运行</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">--name 给容器命名</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">-p 宿主机端口：容器内部端口</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">nginx        latest    ea335eea17ab   12 days ago    141MB</span><br><span class="line">mysql        8.0       b05128b000dd   12 days ago    516MB</span><br><span class="line">mysql        latest    b05128b000dd   12 days ago    516MB</span><br><span class="line">centos       latest    5d0da3dc9764   2 months ago   231MB</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">我们通过-d进行后台启动  --name 给我们的容器重新命名  -P 我们容器对外暴露的端口号+</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker run -d --name nginx01 -p 3344:80 nginx</span><br><span class="line">ed2c04828c9f1caa30a2b109af2831b0606e7d1b14122ef66a0df1d0e1a71b93</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED             STATUS          PORTS                  NAMES</span><br><span class="line">ed2c04828c9f   nginx     &quot;/docker-entrypoint.…&quot;   4 seconds ago       Up 3 seconds    0.0.0.0:3344-&gt;80/tcp   nginx01</span><br><span class="line">7020acf78fbd   centos    &quot;/bin/bash&quot;              About an hour ago   Up 12 minutes   </span><br><span class="line"><span class="meta"># </span><span class="language-bash">测试链接</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# curl localhost:3344</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">html &#123; color-scheme: light dark; &#125;</span><br><span class="line">body &#123; width: 35em; margin: 0 auto;</span><br><span class="line">font-family: Tahoma, Verdana, Arial, sans-serif; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta"># </span><span class="language-bash">进入容器</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker exec -it nginx01 /bin/bash</span><br><span class="line">root@ed2c04828c9f:/# ls</span><br><span class="line">bin  boot  dev	docker-entrypoint.d  docker-entrypoint.sh  etc	home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">root@ed2c04828c9f:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line">root@ed2c04828c9f:/# cd /etc/nginx</span><br><span class="line">root@ed2c04828c9f:/etc/nginx# ls</span><br><span class="line">conf.d	fastcgi_params	mime.types  modules  nginx.conf  scgi_params  uwsgi_params</span><br></pre></td></tr></table></figure>
<p><code>公网访问nginx:</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211130151029501.png" alt="image-20211130151029501"></p>
<p>端口暴露示意图：</p>
<p><img src="https://img-blog.csdnimg.cn/2021072014364032.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>思考问题：我们每次改动nginx配置文件，都需要进入容器内部？十分的麻烦，我要是可以在容器外部提供一个映射路径，达到在容器修改文件名，容器内部就可以自动修改？ -v 数据卷！</p>
<h3 id="5-2安装tomcat"><a href="#5-2安装tomcat" class="headerlink" title="5.2安装tomcat"></a>5.2<strong>安装tomcat</strong></h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">官方的使用</span></span><br><span class="line">docker run -it --rm tomcat:9.0</span><br><span class="line"><span class="meta"># </span><span class="language-bash">我们之前的启动都是后台，停止了容器之后，容器还是可以查到     docker run -it --<span class="built_in">rm</span>，一般用来测试，用完就删除</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">下载再启动</span></span><br><span class="line">docker pull tomcat </span><br><span class="line"><span class="meta"># </span><span class="language-bash">启动运行</span></span><br><span class="line">docker run -d -p 3355:8080 --name tomcat01 tomcat</span><br><span class="line"><span class="meta"># </span><span class="language-bash">测试访问没有问题</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">进入容器</span></span><br><span class="line">[root@iZ8vbgc3u6dvwrjyp45lyrZ home]# docker exec -it tomcat01 /bin/bash</span><br><span class="line"><span class="meta"># </span><span class="language-bash">发现问题：1、linux命令少了，2、没有webapps，阿里云镜像的原因。默认是最小的镜像，所有不必要的都剔除掉了。</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">保证最小可运行的环境</span></span><br></pre></td></tr></table></figure>
<p>思考：如果我们需要部署项目的话，如果我们每次都要进入容器的话是十分麻烦的？如果我们在外部提供了一个映射路径，webapps,那么我们在外部放置项目，就自动同步到内部就好了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211130152354136.png" alt="image-20211130152354136"></p>
<h3 id="5-3部署es-kibana"><a href="#5-3部署es-kibana" class="headerlink" title="5.3部署es+kibana**"></a><em>5.3</em>部署es+kibana**</h3><ul>
<li>es 暴露的端口很多！</li>
<li>es 十分消耗内存</li>
<li>es 的数据一般需要放置到安全目录！挂载</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">--net somenetwork ? 网络配置</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">下载启动elasticsearch（Docker一步搞定）</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">我们可以使用docke stats 来查看cpu的状态</span></span><br><span class="line">CONTAINER ID   NAME      CPU %     MEM USAGE / LIMIT   MEM %     NET I/O   BLOCK I/O   PIDS</span><br><span class="line"><span class="meta">#</span><span class="language-bash">此时我们已经关闭了大部分的进程，为了避免elassicSearch很卡，我们就先关闭其他的全部的端口</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">（轻身经历，不要自己尝试去安装，巨卡无比）</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">测试一下es是否成功启动</span></span><br><span class="line">➜ ~ curl localhost:9200</span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot; : &quot;d73ad2f22dd3&quot;,</span><br><span class="line">&quot;cluster_name&quot; : &quot;docker-cluster&quot;,</span><br><span class="line">&quot;cluster_uuid&quot; : &quot;atFKgANxS8CzgIyCB8PGxA&quot;,</span><br><span class="line">&quot;version&quot; : &#123;</span><br><span class="line">&quot;number&quot; : &quot;7.6.2&quot;,</span><br><span class="line">&quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line">&quot;build_type&quot; : &quot;docker&quot;,</span><br><span class="line">&quot;build_hash&quot; : &quot;ef48eb35cf30adf4db14086e8aabd07ef6fb113f&quot;,</span><br><span class="line">&quot;build_date&quot; : &quot;2020-03-26T06:34:37.794943Z&quot;,</span><br><span class="line">&quot;build_snapshot&quot; : false,</span><br><span class="line">&quot;lucene_version&quot; : &quot;8.4.0&quot;,</span><br><span class="line">&quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,</span><br><span class="line">&quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看docker容器使用内存情况（每秒刷新，也挺耗内存的一个命令）</span></span><br><span class="line">➜ ~ docker stats</span><br><span class="line"><span class="meta">#</span><span class="language-bash">关闭，添加内存的限制，修改配置文件 -e 环境配置修改</span></span><br><span class="line">➜ ~ docker rm -f d73ad2f22dd3</span><br><span class="line">➜ ~ docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e</span><br><span class="line">&quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot;</span><br><span class="line">elasticsearch:7.6.2</span><br><span class="line"><span class="meta">#</span><span class="language-bash">下面的这个是搬用别人的结果</span></span><br><span class="line">➜ ~ curl localhost:9200</span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot; : &quot;b72c9847ec48&quot;,</span><br><span class="line">&quot;cluster_name&quot; : &quot;docker-cluster&quot;,</span><br><span class="line">&quot;cluster_uuid&quot; : &quot;yNAK0EORSvq3Wtaqe2QqAg&quot;,</span><br><span class="line">&quot;version&quot; : &#123;</span><br><span class="line">&quot;number&quot; : &quot;7.6.2&quot;,</span><br><span class="line">&quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line">&quot;build_type&quot; : &quot;docker&quot;,</span><br><span class="line">&quot;build_hash&quot; : &quot;ef48eb35cf30adf4db14086e8aabd07ef6fb113f&quot;,</span><br><span class="line">&quot;build_date&quot; : &quot;2020-03-26T06:34:37.794943Z&quot;,</span><br><span class="line">&quot;build_snapshot&quot; : false,</span><br><span class="line">&quot;lucene_version&quot; : &quot;8.4.0&quot;,</span><br><span class="line">&quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,</span><br><span class="line">&quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;</span><br><span class="line">&#125;,</span><br><span class="line">&quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>作业：使用kibana连接es？思考网络如何才能连接。</p>
<p><img src="https://img-blog.csdnimg.cn/20210720172452779.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="5-4-Docker可视化"><a href="#5-4-Docker可视化" class="headerlink" title="5.4 Docker可视化"></a>5.4 Docker可视化</h3><ul>
<li>什么是portainer？</li>
</ul>
<p>Docker图形化界面管理工具！提供一个后台面板供我们操作！</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">运行如下命令即可 打开可视化服务    -v是挂在，将里面的数据挂在到我们的本机   后面的这个--privileged=<span class="literal">true</span>是授权可以访问，最后的就是安装</span></span><br><span class="line">docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br></pre></td></tr></table></figure>
<p>访问：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://ip:8088/">http://ip:8088/</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211130163401229.png" alt="image-20211130163401229"></p>
<p>注册登录之后，我们选择一个本地的链接就可以了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211130163546756.png" alt="image-20211130163546756"></p>
<p>登录之后，我们就可以看到当前的这个界面，就是我们本地的docker服务了</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211130163749501.png" alt="image-20211130163749501"></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211130163908561.png" alt="image-20211130163908561"></p>
<p>平时用的很少的，自己测试玩玩就可以了。</p>
<ul>
<li>Rancher(CI/CD)持续集成和持续部署的时候再用</li>
</ul>
<h2 id="六、Docker镜像讲解"><a href="#六、Docker镜像讲解" class="headerlink" title="六、Docker镜像讲解"></a>六、Docker镜像讲解</h2><h3 id="6-1-镜像是什么"><a href="#6-1-镜像是什么" class="headerlink" title="6.1 镜像是什么?"></a>6.1 镜像是什么?</h3><p><code>镜像是一种轻量级、可执行的独立软件包</code>，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括<code>代码</code>、<code>运行时</code>、<code>库</code>、<code>环境变量</code>和<code>配置文件</code>。</p>
<p><strong>所有的应用，直接打包docker镜像，就可以直接跑起来！</strong></p>
<p>如何得到镜像：</p>
<ul>
<li><strong>从远程仓库下载</strong></li>
<li><strong>朋友拷贝给你</strong></li>
<li><strong>自己制作一个镜像DockerFile</strong></li>
</ul>
<h3 id="6-2-Docker镜像加载原理"><a href="#6-2-Docker镜像加载原理" class="headerlink" title="6.2 Docker镜像加载原理?"></a>6.2 Docker镜像加载原理?</h3><h4 id="6-2-1-UnionFS（联合文件系统）："><a href="#6-2-1-UnionFS（联合文件系统）：" class="headerlink" title="6.2.1 UnionFS（联合文件系统）："></a><strong>6.2.1 UnionFS（联合文件系统）</strong>：</h4><p>Union文件系统（UnionFS）是<code>一种分层、轻量级并且高性能的文件系统</code>，它支持对文件系统的修改作为一次提交来一层层的叠加，类似于Git中的一层一层提交的一个概念，同时可以将不同目录挂载到同一个虚拟文件系统下（unite several directories into a single virtual filesystem）。Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p>
<p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把文件系统及叠加起来，这样最终的文件系统包含所有底层的文件和目录</p>
<p>我们下载的时候看到的一层一层的那个东西，就是我们的一个UnionFS的一个概念：</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211130164813095.png" alt="image-20211130164813095"></p>
<p><strong>分层下载。</strong></p>
<p>我们打个比方，我们现在下载一个mysql5.7版本的镜像，我们再去下载一个mysql8.0版本的镜像，此时我们看下有什么不同点：</p>
<p>mysql5.7 下载：</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211130165128846.png" alt="image-20211130165128846"></p>
<p><strong>mysql8.0下载：<code>此时我们发现，我们下载的时候，提示了，很多文件已经存在了，那么我们就不需要再去下载，我们只需要下载8.0的一些核心文件就可以了，此时，用到的就是我们的一个联合文件系统的一个东西。极大的节省了内存和空间</code>。</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211130165204766.png" alt="image-20211130165204766"></p>
<h4 id="6-2-2Dcoker镜像加载原理"><a href="#6-2-2Dcoker镜像加载原理" class="headerlink" title="6.2.2Dcoker镜像加载原理"></a>6.2.2<strong>Dcoker镜像加载原理</strong></h4><p>docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。</p>
<p><strong>bootfs</strong>（boot file system）:主要包含bootloader和kernel，bootloader主要是引导加载kernel，Linux刚启动时会加载bootfs文件系统，在Docker镜像的最底层是bootfs。这一层与我们电箱的Linux/Unix系统是一样的，包含boot加载器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由bootfs转交给内核，此时系统也会卸载bootfs。</p>
<blockquote>
<p><code>这个bootfs就相当我们系统启动时候的引导加载，我们启动的时候，主需要一个内核Kernel，以及一个我们用到的加载器bootloader,加载器加载内核之后，我们的系统就运行起来了</code>，此时系统就会卸载bootfs</p>
</blockquote>
<p><strong>rootfs</strong>（root file system）:在bootfs之上。包含的就是典型Linux 系统中的 /dev，/proc，/bin，/etc 等标准目录和文件。rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。</p>
<p><img src="https://img-blog.csdnimg.cn/20210721144206155.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ul>
<li><p>平时我们安装进虚拟机的CentOS都是好几个G，为什么Docker这里才200M？</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">mysql                 5.7       8b43c6af2ad0   12 days ago    448MB</span><br><span class="line">mysql                 8.0       b05128b000dd   12 days ago    516MB</span><br><span class="line">portainer/portainer   latest    580c0e4e98b0   8 months ago   79.1MB</span><br></pre></td></tr></table></figure>
<blockquote>
<p>对于个精简的<code>OS</code>,<code>rootfs</code>可以很小，只需要包合最基本的命令，工具和程序库就可以了，因为底层直接用<code>Host</code>的<code>kernel</code>，自己只需要提供<code>rootfs</code>就可以了。由此可见对于不同的Linux发行版， boots基本是一致的， <code>rootfs</code>会有差別，因此不同的发行版可以公用<code>bootfs</code>。</p>
<p>虚拟机是分钟级别，容器是秒级！</p>
</blockquote>
</li>
</ul>
<h3 id="6-3、分层理解"><a href="#6-3、分层理解" class="headerlink" title="6.3、分层理解"></a>6.3、分层理解</h3><p>我们可以去下载一个镜像，注意观察下载的日志输出，可以看到是一层层的在下载 ，可能有些层是与我们之前是有一些冲突的，或许也有一些层在我们之前下载镜像的时候已经下载过了，所以我们此时下载的时候，我们看下结果。</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211130165204766.png" alt="image-20211130165204766"></p>
<p>思考：为什么Docker镜像要采用这种分层的结构呢？</p>
<p>最大的好处，我觉得莫过于资源共享了！比如有多个镜像都从相同的Base镜像构建而来，那么宿主机只需在磁盘上保留一份base镜像，同时内存中也只需要加载一份base镜像，这样就可以为所有的容器服务了，而且镜像的每一层都可以被共享。</p>
<p>查看镜像分层的方式可以通过docker image inspect 命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker inspect redis</span><br></pre></td></tr></table></figure>
<p><strong>最后展示的结果，就是我们所看到的每一层的效果的</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211130170514747.png" alt="image-20211130170514747"></p>
<p>理解：</p>
<p>所有的<code>docker镜像</code>都起始于一个<code>基础镜像层</code>，当进行修改或者增加新的内容时，就会在当前镜像层之上，创建新的镜像层。</p>
<blockquote>
<p>举一个简单的例子，加入基于Ubuntu Linux 16.04创建一个新的镜像，这就是新镜像的第一层；如果在该镜像中添加Python包，就会在基础镜像层之上穿件第二个镜像层；这个就像是windows里面的安全补丁的原理差不多，如果继续添加一个安全补丁，就会创建第三个镜像层。</p>
</blockquote>
<p>该镜像当前已经包含3个镜像层，如下图（这只是一个用于演示的很简单的例子）。</p>
<p><img src="https://img-blog.csdnimg.cn/20210721150133371.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>在添加额外的镜像层的同时，镜像始终是保持当前所有镜像的组合，理解这一点非常重要。下图中举了一个简单的例子，每个镜像层包含3个文件，而镜像层包含了来自两镜像层的6个文件。</p>
<p><img src="https://img-blog.csdnimg.cn/202107211515246.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>上图中的镜像层跟之前图中的略有区别，主要目的是便于展示文件。</p>
<p>下图总展示了一个稍微复杂的三层镜像，在外部看来整个镜像只有6个文件，这是因为最上层的文件7是文件5的一个更新版本。</p>
<blockquote>
<p><strong>比如说我们在我们一些基础层当中，原本有了一些环境，比如java、tomcat、maven，然后我们需要再去安装一些redis、mysql或者是python等等，那么我们就只需要在层的概念上，我们添加上一层我们需要添加的环境就可以了，这个是不互相影响的。</strong></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/2021072115154375.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>那么如果我们此时有一个新增的镜像，此时第一层也是基础的java、tomcat、maven等等，那我们此时第一层的时候就不需要去新建一个层，将我们刚刚的那个镜像的第一层的基础，直接拿过来用就可以了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211130171412778.png" alt="image-20211130171412778"></p>
<p>如果我们的其他层级也不变，那我们也可以直接服用就可以了，如果其他的一些文件发生了一些变化，那我们只需要操作文件就可以，新增挥着修改这一层的文件。所有的镜像都是一步一步的进行分层的 </p>
<p>这种情况下，上层镜像层中的文件覆盖了底层镜像层中的文件。这样就使得文件的更新版本作为一个新的镜像层添加到镜像当中。</p>
<p>Docker通过存储引擎（新版本采用快照机制）的方式来实心镜像层堆栈，并保证多镜像层对外展示为统一的文件系统。</p>
<p>Linux 上可用的存储引擎有AUFS、Overlay2，Device Maper、Btrfs 以及 ZFS。顾名思义，没种存储引擎都基于Linux中对应的文件系统或者块设备技术，并且每种存储引擎都有其独有的性能特点。</p>
<p>Docker在Windows上仅支持windowsfiler 一种存储引擎，该引擎基于NTFS文件系统之上实现了分层和CoW。</p>
<p>下图展示了与系统显示相同的三层镜像。所有镜像层堆叠并合并，对外提供统一的视图。</p>
<p><img src="https://img-blog.csdnimg.cn/20210721155437445.png" alt="在这里插入图片描述"></p>
<p><strong>特点</strong></p>
<p>Docker镜像都是只读的，当容器启动时，一个新的可写层被加载到镜像的顶部！</p>
<p>这一层就是我们通常说的容器层，容器之下的都叫镜像层。</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211130174838804.png" alt="image-20211130174838804"></p>
<p><strong>我们原本的tomcat只是一个镜像，如果我们在tomcat上执行一些操作的话，我们就会在本来tomcat上新增一层，我们执行的所有的操作都在这里，此时我们将我们的tomcat底层镜像和我们对它的一些操作，依然可以打包成一个大的新的镜像。</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211130200246710.png" alt="image-20211130200246710"></p>
<h3 id="6-4-commit镜像"><a href="#6-4-commit镜像" class="headerlink" title="6.4 commit镜像"></a>6.4 commit镜像</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker commit 提交容器成为一个新的副本</span><br><span class="line"><span class="meta"># </span><span class="language-bash">命令和git原理类似</span></span><br><span class="line">docker commit -m=&quot;描述信息&quot; -a=&quot;作者&quot; 容器id 目标镜像名:[TAG]</span><br></pre></td></tr></table></figure>
<p>实战测试：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">1、启动一个默认的tomcat</span></span><br><span class="line">docker run -d -p 8080:8080 tomcat</span><br><span class="line"><span class="meta"># </span><span class="language-bash">2、发现这个默认的tomcat 是没有webapps应用，官方的镜像默认webapps下面是没有文件的！</span></span><br><span class="line">docker exec -it 容器id</span><br><span class="line"><span class="meta"># </span><span class="language-bash">3、拷贝文件进去</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">4、将操作过的容器通过commit**为一个镜像！我们以后就使用我们修改过的镜像即可，这就是我们自己的一个修改的镜像。</span></span><br><span class="line">docker commit -m=&quot;描述信息&quot; -a=&quot;作者&quot; 容器id 目标镜像名:[TAG]docker commit -a=&quot;kuangshen&quot; -m=&quot;add webapps app&quot; 容器id tomcat02:1.0</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211130205722972.png" alt="image-20211130205722972"></p>
<p>如果你想要保存当前容器的状态，就可以通过commit来提交，获得一个镜像，就好比我们我们使用虚拟机的快照。</p>
<p>到了这里才算入门成功！！！！</p>
<h2 id="七、容器数据卷"><a href="#七、容器数据卷" class="headerlink" title="七、容器数据卷"></a>七、容器数据卷</h2><h3 id="7-1-什么是容器卷？"><a href="#7-1-什么是容器卷？" class="headerlink" title="7.1 什么是容器卷？"></a>7.1 什么是容器卷？</h3><p>docker的理念回顾</p>
<p>将应用和环境打包成一个镜像！</p>
<p>数据？如果数据都在容器中，那么我们容器删除，数据就会丢失！·需求：<code>数据可以持久化</code></p>
<p>MySQL，容器删除了，删库跑路！需求：<code>MySQL数据可以存储在本地</code>！</p>
<p>容器之间可以有一个数据共享的技术！Docker容器中产生的数据，同步到本地！</p>
<p>这就是卷技术！目录的挂载，将我们容器内的目录，挂载到Linux上面！</p>
<p><img src="https://img-blog.csdnimg.cn/20210721201603322.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>总结一句话：容器的持久化和同步操作！容器间也是可以数据共享的！</p>
<h3 id="7-2-使用数据卷"><a href="#7-2-使用数据卷" class="headerlink" title="7.2 使用数据卷"></a>7.2 使用数据卷</h3><p>方式一 ：直接使用命令挂载 -v</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-v, --volume list Bind mount a volume</span><br><span class="line">docker run -it -v 主机目录:容器内目录 </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">测试案例</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker run -it -v /home/centosTest:/home centos /bin/bash</span><br><span class="line">[root@7ec96a6e11b1 /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@7ec96a6e11b1 /]# cd home</span><br><span class="line">[root@7ec96a6e11b1 home]# [root@iZuf65oftugvcjgk2jncyeZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND        CREATED          STATUS          PORTS                    NAMES</span><br><span class="line">7ec96a6e11b1   centos                &quot;/bin/bash&quot;    14 seconds ago   Up 13 seconds                            wonderful_babbage</span><br><span class="line">0cbfc2fdebb0   tomcat:8.0            &quot;/bin/bash&quot;    13 hours ago     Up 13 hours     0.0.0.0:3344-&gt;8080/tcp   tomcat_cesium</span><br><span class="line">f8e444781a2b   portainer/portainer   &quot;/portainer&quot;   17 hours ago     Up 17 hours     0.0.0.0:8088-&gt;9000/tcp   friendly_black</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">我们可以通国如下命令查看</span></span><br><span class="line">docker inspect</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201090838131.png" alt="image-20211201090838131"></p>
<p>测试文件的同步:</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201091209467.png" alt="image-20211201091209467"></p>
<p><strong>我们此时发现，我们容器内的数据和我们宿主机的挂在地址的数据是同步的。</strong></p>
<p>再来测试！<br><strong>1、停止容器</strong><br><strong>2、宿主机修改文件</strong><br><strong>3、启动容器</strong><br><strong>4、容器内的数据依旧是同步的</strong></p>
<p>5.<strong>数据的同步是双向的</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201092052234.png" alt="image-20211201092052234"></p>
<h3 id="7-3-实战：安装MySQL"><a href="#7-3-实战：安装MySQL" class="headerlink" title="7.3 实战：安装MySQL"></a>7.3 实战：安装MySQL</h3><p>思考：MySQL的数据持久化的问题</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">1.获取mysql镜像</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">2.运行容器,需要做数据挂载</span> </span><br><span class="line"><span class="meta"># </span><span class="language-bash">3.安装启动mysql，需要配置密码的，这是要注意点！</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">参考官网hub</span></span><br><span class="line">docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br><span class="line"><span class="meta">#</span><span class="language-bash">启动我们得</span></span><br><span class="line">-d 后台运行</span><br><span class="line">-p 端口映射</span><br><span class="line">-v 卷挂载</span><br><span class="line">-e 环境配置  MYSQL_ROOT_PASSWORD mysql启动的时候需要我们手动去配置数据密码</span><br><span class="line">-- name 容器名字</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker run -d -p 3305:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name=mysql01 mysql:8.0</span><br><span class="line">363237d651c59a35ce0069a1b224481eecc4c07ec7dda22f6f86812d7b7d6f59</span><br><span class="line"><span class="meta"># </span><span class="language-bash">启动成功之后，我们在本地使用navicat来测试一下</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">navicat-连接到服务器的3305--和容器内的3306映射</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">在本地测试创建一个数据库，查看一下我们映射的路径是否ok！</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-2021120109470036123.png" alt="image-20211201094700361"></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201093838156.png" alt="image-20211201093838156"></p>
<p>此时我们本地连接的时候，我们手动创建了一个数据库，我们去镜像中看下，是否存在一个。此时我们发现，我们的数据在我们的宿主机和容器内都是同时存在的</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201095100098.png" alt="image-20211201095100098"></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201095039843.png" alt="image-20211201095039843"></p>
<p>那么如果我们之后想要去修改mysql的配置文件，我们只需要在挂在的宿主机的文件目录下修改即可。</p>
<p>那如果我们此时有个场景，如果我们把mysql的镜像都删除掉了，那么我们的数据会被删除吗，我们测试下。</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201095403173.png" alt="image-20211201095403173"></p>
<p>在我们删除完数据之后，我们的容器没有了，但是我们宿主机中的数据依旧是存在的。数据依旧是保存在我们的本地，数据是不会丢失的。这就实现了我们的容器数据持久化功能。</p>
<h3 id="7-4-具名和匿名挂载"><a href="#7-4-具名和匿名挂载" class="headerlink" title="7.4 具名和匿名挂载"></a>7.4 具名和匿名挂载</h3><h4 id="7-4-1-匿名挂载"><a href="#7-4-1-匿名挂载" class="headerlink" title="7.4.1 匿名挂载"></a>7.4.1 匿名挂载</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-v 容器内路径</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">-d  后台启动</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">-P 随机端口</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">--name 容器命名</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">-v 挂载地址</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line">Unable to find image &#x27;nginx:latest&#x27; locally</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">eff15d958d66: Already exists </span><br><span class="line">1e5351450a59: Pull complete </span><br><span class="line">2df63e6ce2be: Pull complete </span><br><span class="line">9171c7ae368c: Pull complete </span><br><span class="line">020f975acd28: Pull complete </span><br><span class="line">266f639b35ad: Pull complete </span><br><span class="line">Digest: sha256:097c3a0913d7e3a5b01b6c685a60c03632fc7a2b50bc8e35bcaa3691d788226e</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">5277eeef2d08bd10759a69068ae89b4a8c449d08be514cf0822f62d72912567b</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看所有数据卷  这些都是匿名的  这就是匿名挂载  就像我们java中去new一个匿名内部类，这个内部类是没有名字的</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     2c38ac8053ab09fdd8b18ac921b4f08bee0c4789420eb21261dcb3921332e33b</span><br><span class="line">local     2ce495b1fffb7902dc33945543608fa9829bc15753764f548eb823169b7d6362</span><br><span class="line">local     125f78fb872eee7af45cc23cd7224432ab3b0a6425578f90fbf22a44b06cb3e2</span><br><span class="line">local     0155988c6b53246891a663b09b7ff31f4e033845f915ab6cbb435bd32e9d3a11</span><br><span class="line">local     aa9e30b0c9437a528c1142a9ec0bcc44eb81df9a17e3150eec9d919bc1013942</span><br><span class="line">local     fa435dae2195899e60a26aad1f5ed0fb8e9864ac29d5e8ac8330633abf704cf8</span><br></pre></td></tr></table></figure>
<h4 id="7-4-2-具名挂载"><a href="#7-4-2-具名挂载" class="headerlink" title="7.4.2 具名挂载"></a>7.4.2 具名挂载</h4><p>我们重启动一个新的容器，给他命名，然后我们去具体的看下他的volume</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker run -d -P --name nginx02 -v nginx_hh:/etc/nginx nginx</span><br><span class="line">998a07b58223180bb99e6a57da9d08bf4f6327e62c95a1eb78bde1d23acb29d1</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     2c38ac8053ab09fdd8b18ac921b4f08bee0c4789420eb21261dcb3921332e33b</span><br><span class="line">local     2ce495b1fffb7902dc33945543608fa9829bc15753764f548eb823169b7d6362</span><br><span class="line">local     125f78fb872eee7af45cc23cd7224432ab3b0a6425578f90fbf22a44b06cb3e2</span><br><span class="line">local     0155988c6b53246891a663b09b7ff31f4e033845f915ab6cbb435bd32e9d3a11</span><br><span class="line">local     aa9e30b0c9437a528c1142a9ec0bcc44eb81df9a17e3150eec9d919bc1013942</span><br><span class="line">local     fa435dae2195899e60a26aad1f5ed0fb8e9864ac29d5e8ac8330633abf704cf8</span><br><span class="line">local     nginx_hh</span><br></pre></td></tr></table></figure>
<p>此时我们发现，我们指定的这个nginx__hh卷名，在我们的数据卷列表中可以看到，那么我们如何查看这个卷<code>在哪个目录下面</code>呢</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker volume inspect nginx_hh</span><br><span class="line">或者</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker inspect nginx_hh</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201131658871.png" alt="image-20211201131658871"></p>
<p>所有的docker容器内的卷，没有指定目录的情况下都是在 <code>/var/lib/docker/volumes/xxx/_data</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201131956641.png" alt="image-20211201131956641"></p>
<p>我们通过具名挂载可以方便的找到我们的 一个卷，大多数情况使用的是 具名挂载</p>
<p><strong>那么我们是如何确定是具名挂载，还是匿名挂载还是指定路径挂载呢？</strong></p>
<ul>
<li>-v 容器内地址     <code>匿名挂载</code></li>
<li>-v 卷名:容器内地址  <code>具名挂载</code></li>
<li>-v /宿主机路径：容器路径  <code>指定路径挂载</code></li>
</ul>
<p>拓展：</p>
<p><code>通过 -v 容器内路径： ro rw 改变读写权限</code></p>
<ul>
<li>ro readonly   只读</li>
<li><p>rw readwrite  可读可写</p>
<p><strong>一旦设置了容器权限，容器对我们挂载出来的内容就有限定了！</strong></p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -P --name nginx05 -v juming:/etc/nginx:ro nginx</span><br><span class="line">docker run -d -P --name nginx05 -v juming:/etc/nginx:rw nginx</span><br></pre></td></tr></table></figure>
<p><strong>ro 只要看到ro就说明这个路径只能通过宿主机来操作，容器内部是无法操作！</strong></p>
<h3 id="7-5-初识Dockerfile"><a href="#7-5-初识Dockerfile" class="headerlink" title="7.5 初识Dockerfile"></a>7.5 初识Dockerfile</h3><p>Dockerfile 就是用来构建docker镜像的构建文件！</p>
<p>镜像是如何生成的，我们就可以通过Dockerfile来一步一步的去进行构建，之前我们可以通过commit的方式来创建，现在我们需要通过Dockerfile的方式来进行构建，其实这就是一堆的<code>命令</code>和<code>脚本</code></p>
<p>通过这个脚本可以生成镜像，镜像是一层一层的，脚本就是一个一个的命令.</p>
<p>我们只需要去写一个一个的Dockerfile的命令去执行一下就可以了。</p>
<p>1<strong>.我们先创建一个dockerfile，名字随便定义</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ docker-test-volume]# cat dockerfile01 </span><br><span class="line">FROM centos</span><br><span class="line">VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]</span><br><span class="line">CMD echo &quot;-----end-----&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="meta"># </span><span class="language-bash">这里的每个命令，就是镜像的一层！</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201134735503.png" alt="image-20211201134735503"></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201134757322.png" alt="image-20211201134757322"></p>
<p>启动自己写的镜像</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/20210722153212255.png" alt="img"></p>
<p>这个卷和外部有一个同步的目录，我们去看一下，我们简单修改下容器中数据卷目录下，然后看下，宿主机中的目录中是否有新增。</p>
<p><img src="https://img-blog.csdnimg.cn/20210722155132469.png" alt="在这里插入图片描述"></p>
<p>查看一下卷挂载的路径</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker inspect 容器id</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201140059739.png" alt="image-20211201140059739"></p>
<p>我们通过如上命令查看到了我们挂载的本地路径，我们测试下，数据是否进行同步，我们在我们自己构建的容器中的volume1中新增一个文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201140258123.png" alt="image-20211201140258123"></p>
<p>我们再去宿主机的相关目录中查看是否有新的文件生成</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201140354956.png" alt="image-20211201140354956"></p>
<p>此时我们发现，在我们的宿主机当中，也生成了一个对应的文件。</p>
<p>这种方式使用的十分多，因为我们通常会构建自己的镜像！在我们构建镜像的 时候，我们就去指定我们挂载 的目录。</p>
<p>假设构建镜像时候没有挂载卷，要手动镜像挂载 -v 卷名：容器内路径！</p>
<h3 id="7-6-数据卷容器"><a href="#7-6-数据卷容器" class="headerlink" title="7.6 数据卷容器"></a>7.6 数据卷容器</h3><p>多个MySQL同步数据！</p>
<p>命名的容器挂载数据卷！</p>
<p>我们现在有两个容器，centos01和centos02,我们现在有个需求就是实现01和02的数据同步，一般我们把谁去挂载了谁，我们成为父容器，里面的数据内容就都是同步的了，被挂载的这个父容器，就是我们所谓的数据卷容器。我们可以通过此种方式实现，容器间的共享，或者共享给别人。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/509123ae482041b594dff90c81dd799c.png" alt="在这里插入图片描述"></p>
<p><code>启动3个容器，通过我们刚才自己写的镜像启动</code>,我们依次启动docker01,docker02,docker03</p>
<p><strong>docker01</strong>-&gt;<strong>docker02</strong>-&gt;<strong>docker03</strong><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201141656655.png" alt="image-20211201141656655"></p>
<p>我们在创建第二个容器的时候，我们就需要去指定需要<code>继承</code>的<code>docker01</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">--volumes-from list                Mount volumes from the specified container(s)</span><br><span class="line"><span class="meta"># </span><span class="language-bash">测试，</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ _data]# docker run -it --name dockerTest02 --volumes-from dockerTest01 liuhuanhuan:1.0</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201142407487.png" alt="image-20211201142407487"></p>
<p>此时我们去dockerTest01中去新增一个文件，看下，我们的dockerTest02中的数据是否同步了</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201142753004.png" alt="image-20211201142753004"></p>
<p>此时我们会发现，我们的docerTest01和我们的dockerTest02中的数据是同步的。</p>
<p>我们一旦使用<code>–volumes-from</code>我们就实现了数据的同步挂载，类似我们java中的父类和子类的关系被继承的，我们叫做<code>数据卷容器</code>。如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201143317423.png" alt="image-20211201143317423"></p>
<p>我们此时再新建一个dockerTest03，我们也继承与我们的01。此时我们看下，数据是否进行了同步。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ /]# docker run -it --name dockerTest03 --volumes-from dockerTest01 liuhuanhuan:1.0</span><br></pre></td></tr></table></figure>
<p>此时我们新建了一个dockerTest03，我们再去看下目录下，我们的数据依旧是进行同步的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201143730884.png" alt="image-20211201143730884"></p>
<p>此时我们考虑在我们的docerTest03中，新建了一个文件，我们去01和02中查看下，数据是否进行了同步呢。</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201144057085.png" alt="image-20211201144057085"></p>
<p>此时我们发现，3个容器目录下的数据是进行同步的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201144238534.png" alt="image-20211201144238534"></p>
<p>由于<code>dockerTest01</code>是数据容器卷，<code>dockerTest02</code>和<code>dockerTest03</code>都是基于他的,那么此时我们考虑一个场景，如果我们将<code>dockerTest01</code>停掉，或者删除掉这个容器的话，那么<code>docerTest02</code>和<code>dockerTest03</code>中的数据是否还存在呢。</p>
<p>测试下，我们删除这个<code>dockerTest01</code>的这个数据容器，此时我们通过docker ps -a发现已经被全部删除了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201144729666.png" alt="image-20211201144729666"></p>
<p><strong>现在已经<code>dockerTest01</code>已经被删除了，那么我们去看下我们的<code>dockerTest02</code>和<code>dockerTest03</code>中的数据是否还在呢？</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201144923075.png" alt="image-20211201144923075"></p>
<p>此时我们去<code>dockerTest03</code>中去发现，我们的数据依旧是存在的。nice!!!!!!</p>
<p><strong>这种容器之间的数据共享的机制，其实就是一共<code>数据备份</code>的机制，也就是一种<code>双向拷贝</code>的概念.</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201145255469.png" alt="image-20211201145255469"></p>
<h3 id="7-7-多个mysql实现数据共享"><a href="#7-7-多个mysql实现数据共享" class="headerlink" title="7.7 多个mysql实现数据共享"></a>7.7 多个mysql实现数据共享</h3><p>我们来测试下，新建多个mysql数据容器的创建，此时我们新建了第一个容器：我们新建之后，我们本地连接测试下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it -p 3305:3306 --name mysql01 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 mysql:8.0 </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201150155209.png" alt="image-20211201150155209"></p>
<p>此时我们去新建第二个mysql02容器  由于我们的文件的地址是一样的，所以我们在继承的时候，不需要再去指定相关路径了，我们直接使用就可以了。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker run -d -p 3307:3306 -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-from mysql01 mysql:8.0</span><br><span class="line">6fffaa5beb7079e3b1bf8e0a103d2170b00ccae10acee29717111248047ba7c5</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE             COMMAND                  CREATED          STATUS          PORTS                               NAMES</span><br><span class="line">6fffaa5beb70   mysql:8.0         &quot;docker-entrypoint.s…&quot;   3 seconds ago    Up 3 seconds    33060/tcp, 0.0.0.0:3307-&gt;3306/tcp   mysql02</span><br><span class="line">948f73079989   mysql:8.0         &quot;docker-entrypoint.s…&quot;   3 minutes ago    Up 3 minutes    33060/tcp, 0.0.0.0:3305-&gt;3306/tcp   mysql01</span><br><span class="line">b1bba449a8b9   liuhuanhuan:1.0   &quot;/bin/sh -c /bin/bash&quot;   26 minutes ago   Up 26 minutes                                       dockerTest03</span><br><span class="line">8f03dc19c94b   liuhuanhuan:1.0   &quot;/bin/sh -c /bin/bash&quot;   40 minutes ago   Up 40 minutes                                       dockerTest02</span><br></pre></td></tr></table></figure>
<p>这个时候，我们就可以实现两个容器的数据同步。</p>
<p><strong>结论：</strong></p>
<p>容器之间的配置信息的传递，数据卷容器的生命周期一直持续到没有容器使用为止。因为配置的容器之间的数据一直是相互复制的，直到我们所有继承或者是所有挂载的容器全都删除掉，我们的这个数据卷才会消失。</p>
<p>但是一旦你持久化到了本地，这个时候，本地的数据是不会删除的！</p>
<h2 id="八、DockerFile"><a href="#八、DockerFile" class="headerlink" title="八、DockerFile"></a>八、DockerFile</h2><h3 id="8-1-DockerFile介绍"><a href="#8-1-DockerFile介绍" class="headerlink" title="8.1 DockerFile介绍"></a>8.1 DockerFile介绍</h3><p>dockerfile 是用来构建docker镜像的文件！命令参数脚本！</p>
<p>构建步骤：</p>
<p>1、 编写一个dockerfile文件</p>
<p>2、 docker build 构建称为一个镜像</p>
<p>3、 docker run运行镜像</p>
<p>4、 docker push发布镜像（DockerHub 、阿里云仓库)</p>
<p>查看下官方地址：</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/3e9dde477bcd4f10a93d106af5501e81.png" alt="在这里插入图片描述"></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/765a0bd85ff947fcb008bfc88ecf9cab.png" alt="在这里插入图片描述"></p>
<p>但是很多官方镜像都是基础包，很多功能没有，我们通常会自己搭建自己的镜像！</p>
<p>官方既然可以制作镜像，那我们也可以！</p>
<h3 id="8-2-DockerFile构建过程"><a href="#8-2-DockerFile构建过程" class="headerlink" title="8.2 DockerFile构建过程"></a>8.2 DockerFile构建过程</h3><p>基础知识：</p>
<p>1、每个保留关键字(指令）都是必须是大写字母</p>
<p>2、执行从上到下顺序</p>
<p>3、#表示注释</p>
<p>4、每一个指令都会创建提交一个新的镜像曾，并提交！</p>
<p><img src="https://img-blog.csdnimg.cn/c40a1beeb33140e687c92a3ef54a0680.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>Dockerfile是面向开发的，我们以后要发布项目，做镜像，就需要编写dockerfile文件，这个文件十分简单！</p>
<p>Docker镜像逐渐成企业交付的标准，必须要掌握！</p>
<ul>
<li><p><code>DockerFile</code>：构建文件，定义了一切的步骤，源代码</p>
</li>
<li><p><code>DockerImages</code>：通过DockerFile构建生成的镜像，最终发布和运行产品。</p>
</li>
<li><p><code>Docker容器</code>：容器就是镜像运行起来提供服务。</p>
</li>
</ul>
<h3 id="8-3-DockerFile常用指令"><a href="#8-3-DockerFile常用指令" class="headerlink" title="8.3 DockerFile常用指令"></a>8.3 DockerFile常用指令</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FROM             # 基础镜像，一切从这里开始构建  centos</span><br><span class="line">MAINTAINER        # 镜像是谁写的， 姓名+邮箱</span><br><span class="line">RUN             # 镜像构建的时候需要运行的命令</span><br><span class="line">ADD             # 步骤，tomcat镜像，这个tomcat压缩包！添加内容 添加同目录</span><br><span class="line">WORKDIR         # 镜像的工作目录</span><br><span class="line">VOLUME             # 挂载的目录</span><br><span class="line">EXPOSE             # 暴露端口配置  和我们的-p一样的</span><br><span class="line">CMD             # 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代。</span><br><span class="line">ENTRYPOINT         # 指定这个容器启动的时候要运行的命令，可以追加命令</span><br><span class="line">ONBUILD         # 当构建一个被继承 DockerFile 这个时候就会运行ONBUILD的指令，触发指令。</span><br><span class="line">COPY             # 类似ADD，将我们文件拷贝到镜像中</span><br><span class="line">ENV             # 构建的时候设置环境变量！</span><br></pre></td></tr></table></figure>
<h3 id="8-4-实战测试-构建自己的centos"><a href="#8-4-实战测试-构建自己的centos" class="headerlink" title="8.4 实战测试 构建自己的centos"></a>8.4 实战测试 构建自己的centos</h3><p>Docker Hub中 99% 镜像都是从这个基础镜像过来的<code>FROM scratch</code> , 然后配置需要的软件和配置来进行的构建</p>
<p><img src="https://img-blog.csdnimg.cn/1e323c4feaf9415cbc0a79e7e2418c90.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3N1MjIzMTU5NTc0Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>案例：创建一个自己的centos</p>
<p>我们看下之前的centos的环境：</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201203621155.png" alt="image-20211201203621155"></p>
<p>1.编写配置文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# vim myFirstDockerFile</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# cat myFirstDockerFile </span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER liuhuanhuan&lt;liuhuanhuan96@163.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;-----end-----&quot;</span><br><span class="line">CMD /bin/bash  </span><br></pre></td></tr></table></figure>
<p>2.通过这个文件构建镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">命令 docker build -f 文件路径 -t 镜像名:[tag] .</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# docker build -f myFirstDockerFile -t mycentos:1.0 .</span><br></pre></td></tr></table></figure>
<p>我们看下build之后的效果：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# docker build -f myFirstDockerFile -t mycentos:1.0 .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/10 : FROM centos</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">5d0da3dc9764</span></span><br><span class="line">Step 2/10 : MAINTAINER liuhuanhuan&lt;liuhuanhuan96@163.com&gt;</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 8b9a850e6709</span></span><br><span class="line">Removing intermediate container 8b9a850e6709</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">b451c01f5e46</span></span><br><span class="line">Step 3/10 : ENV MYPATH /usr/local</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> a5ceede1147e</span></span><br><span class="line">Removing intermediate container a5ceede1147e</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">cdb4ec6e6af0</span></span><br><span class="line">Step 4/10 : WORKDIR $MYPATH</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> abc95adef4e1</span></span><br><span class="line">Removing intermediate container abc95adef4e1</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">fadd756f9367</span></span><br><span class="line">Step 5/10 : RUN yum -y install vim</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 42df864b1bda</span></span><br><span class="line">CentOS Linux 8 - AppStream                       13 MB/s | 8.1 MB     00:00    </span><br><span class="line">CentOS Linux 8 - BaseOS                         8.0 MB/s | 3.5 MB     00:00    </span><br><span class="line">CentOS Linux 8 - Extras                          16 kB/s |  10 kB     00:00    </span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package             Arch        Version                   Repository      Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> vim-enhanced        x86_64      2:8.0.1763-16.el8         appstream      1.4 M</span><br><span class="line">Installing dependencies:</span><br><span class="line"> gpm-libs            x86_64      1.20.7-17.el8             appstream       39 k</span><br><span class="line"> vim-common          x86_64      2:8.0.1763-16.el8         appstream      6.3 M</span><br><span class="line"> vim-filesystem      noarch      2:8.0.1763-16.el8         appstream       49 k</span><br><span class="line"> which               x86_64      2.21-16.el8               baseos          49 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  5 Packages</span><br><span class="line"></span><br><span class="line">Total download size: 7.8 M</span><br><span class="line">Installed size: 30 M</span><br><span class="line">Downloading Packages:</span><br><span class="line">(1/5): gpm-libs-1.20.7-17.el8.x86_64.rpm        1.2 MB/s |  39 kB     00:00    </span><br><span class="line">(2/5): vim-filesystem-8.0.1763-16.el8.noarch.rp 3.6 MB/s |  49 kB     00:00    </span><br><span class="line">(3/5): which-2.21-16.el8.x86_64.rpm             2.4 MB/s |  49 kB     00:00    </span><br><span class="line">(4/5): vim-enhanced-8.0.1763-16.el8.x86_64.rpm   13 MB/s | 1.4 MB     00:00    </span><br><span class="line">(5/5): vim-common-8.0.1763-16.el8.x86_64.rpm     44 MB/s | 6.3 MB     00:00    </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                           8.0 MB/s | 7.8 MB     00:00     </span><br><span class="line">warning: /var/cache/dnf/appstream-02e86d1c976ab532/packages/gpm-libs-1.20.7-17.el8.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID 8483c65d: NOKEY</span><br><span class="line">CentOS Linux 8 - AppStream                      1.6 MB/s | 1.6 kB     00:00    </span><br><span class="line">Importing GPG key 0x8483C65D:</span><br><span class="line"> Userid     : &quot;CentOS (CentOS Official Signing Key) &lt;security@centos.org&gt;&quot;</span><br><span class="line"> Fingerprint: 99DB 70FA E1D7 CE22 7FB6 4882 05B5 55B3 8483 C65D</span><br><span class="line"> From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">Key imported successfully</span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                        1/1 </span><br><span class="line">  Installing       : which-2.21-16.el8.x86_64                               1/5 </span><br><span class="line">  Installing       : vim-filesystem-2:8.0.1763-16.el8.noarch                2/5 </span><br><span class="line">  Installing       : vim-common-2:8.0.1763-16.el8.x86_64                    3/5 </span><br><span class="line">  Installing       : gpm-libs-1.20.7-17.el8.x86_64                          4/5 </span><br><span class="line">  Running scriptlet: gpm-libs-1.20.7-17.el8.x86_64                          4/5 </span><br><span class="line">  Installing       : vim-enhanced-2:8.0.1763-16.el8.x86_64                  5/5 </span><br><span class="line">  Running scriptlet: vim-enhanced-2:8.0.1763-16.el8.x86_64                  5/5 </span><br><span class="line">  Running scriptlet: vim-common-2:8.0.1763-16.el8.x86_64                    5/5 </span><br><span class="line">  Verifying        : gpm-libs-1.20.7-17.el8.x86_64                          1/5 </span><br><span class="line">  Verifying        : vim-common-2:8.0.1763-16.el8.x86_64                    2/5 </span><br><span class="line">  Verifying        : vim-enhanced-2:8.0.1763-16.el8.x86_64                  3/5 </span><br><span class="line">  Verifying        : vim-filesystem-2:8.0.1763-16.el8.noarch                4/5 </span><br><span class="line">  Verifying        : which-2.21-16.el8.x86_64                               5/5 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  gpm-libs-1.20.7-17.el8.x86_64         vim-common-2:8.0.1763-16.el8.x86_64    </span><br><span class="line">  vim-enhanced-2:8.0.1763-16.el8.x86_64 vim-filesystem-2:8.0.1763-16.el8.noarch</span><br><span class="line">  which-2.21-16.el8.x86_64             </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 42df864b1bda</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">d84b4ffa9afb</span></span><br><span class="line">Step 6/10 : RUN yum -y install net-tools</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 85b0c64b0d12</span></span><br><span class="line">Last metadata expiration check: 0:00:09 ago on Wed Dec  1 12:42:36 2021.</span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package         Architecture Version                        Repository    Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> net-tools       x86_64       2.0-0.52.20160912git.el8       baseos       322 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 322 k</span><br><span class="line">Installed size: 942 k</span><br><span class="line">Downloading Packages:</span><br><span class="line">net-tools-2.0-0.52.20160912git.el8.x86_64.rpm   7.4 MB/s | 322 kB     00:00    </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                           763 kB/s | 322 kB     00:00     </span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                        1/1 </span><br><span class="line">  Installing       : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 </span><br><span class="line">  Running scriptlet: net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 </span><br><span class="line">  Verifying        : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  net-tools-2.0-0.52.20160912git.el8.x86_64                                     </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 85b0c64b0d12</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">3123875290fe</span></span><br><span class="line">Step 7/10 : EXPOSE 80</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 30144fe42de8</span></span><br><span class="line">Removing intermediate container 30144fe42de8</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">802e023a0271</span></span><br><span class="line">Step 8/10 : CMD echo $MYPATH</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> fee95b4dddfc</span></span><br><span class="line">Removing intermediate container fee95b4dddfc</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">eb5650da5a20</span></span><br><span class="line">Step 9/10 : CMD echo &quot;-----end-----&quot;</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 33d26b8a4fc1</span></span><br><span class="line">Removing intermediate container 33d26b8a4fc1</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">4f46706ae96a</span></span><br><span class="line">Step 10/10 : CMD /bin/bash</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 6ad7fa93ddc6</span></span><br><span class="line">Removing intermediate container 6ad7fa93ddc6</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">735e68690d0a</span></span><br><span class="line">Successfully built 735e68690d0a</span><br><span class="line">Successfully tagged mycentos:1.0</span><br></pre></td></tr></table></figure>
<p>我们看到最后都successful，构建成功了，那么我们就成功的构建了一个我们的自己的镜像。</p>
<p>此时我们启动容器，然后查看下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# docker attach 67aefcac09e1</span><br><span class="line">[root@67aefcac09e1 local]# pwd</span><br><span class="line">/usr/local</span><br></pre></td></tr></table></figure>
<p>此时我们会发现，我们进入的就是一个工作目录。就是我们在dockerfile文件中定义的工作目录。此时我们再尝试下ifconfig命令，看下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@67aefcac09e1 local]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.4  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:04  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>
<p>此时我们发现，<code>ifconfig</code>命令可以用了，我们相比较之前的纯净版的centos，我们在构建镜像的 时候，我们就自己下载了很多的镜像。</p>
<p>当我们拿到一个镜像的时候，我们可以通过history的命令查看，我们的这个镜像是怎么一步一步制作起来的。具体的结果如下图。</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211201205251351.png" alt="image-20211201205251351"></p>
<p>此时就列出了，我们刚刚制作的那个镜像的全部历史记录。</p>
<h3 id="8-5-CMD-和-ENTRYPOINT区别"><a href="#8-5-CMD-和-ENTRYPOINT区别" class="headerlink" title="8.5  CMD 和 ENTRYPOINT区别"></a>8.5  CMD 和 ENTRYPOINT区别</h3><ul>
<li><code>CMD</code>        指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代。</li>
<li><code>ENTRYPOINT</code>    指定这个容器启动的时候要运行的命令，可以追加命令</li>
</ul>
<p>测试cmd</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">编写dockerfile文件</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# vim testCmdDockerFile</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# cat testCmdDockerFile </span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta">#</span><span class="language-bash">此时我们就执行一个CMD命令，我们去看下实际的效果</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">此时我们开始去构建docker镜像</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# docker build -f testCmdDockerFile -t cmddocker:1.0 .</span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">5d0da3dc9764</span></span><br><span class="line">Step 2/2 : CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> acb8129389a9</span></span><br><span class="line">Removing intermediate container acb8129389a9</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">c84db5be03af</span></span><br><span class="line">Successfully built c84db5be03af</span><br><span class="line">Successfully tagged cmddocker:1.0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">运行镜像</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# docker run c84db5be03af</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">此时我们发现，他执行的是<span class="built_in">ls</span> -a的一个命令</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">那么如果我们想要追加一个命令-l呢，成为<span class="built_in">ls</span> -al</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# docker run c84db5be03af -l</span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:380: starting container process caused: exec: &quot;-l&quot;: executable file not found in $PATH: unknown.</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">cmd的情况下 -l 替换了CMD[<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-l&quot;</span>]  又由于 -l不是一个命令   所以出现了报错</span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">我们需要写一个完整的路径来代替</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# docker run c84db5be03af ls -al</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x   1 root root   6 Dec  1 13:16 .</span><br><span class="line">drwxr-xr-x   1 root root   6 Dec  1 13:16 ..</span><br><span class="line">-rwxr-xr-x   1 root root   0 Dec  1 13:16 .dockerenv</span><br><span class="line">lrwxrwxrwx   1 root root   7 Nov  3  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root 340 Dec  1 13:16 dev</span><br><span class="line">drwxr-xr-x   1 root root  66 Dec  1 13:16 etc</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 home</span><br><span class="line">lrwxrwxrwx   1 root root   7 Nov  3  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root   9 Nov  3  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------   2 root root   6 Sep 15 14:17 lost+found</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 media</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 mnt</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 opt</span><br><span class="line">dr-xr-xr-x 105 root root   0 Dec  1 13:16 proc</span><br><span class="line">dr-xr-x---   2 root root 162 Sep 15 14:17 root</span><br><span class="line">drwxr-xr-x  11 root root 163 Sep 15 14:17 run</span><br><span class="line">lrwxrwxrwx   1 root root   8 Nov  3  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 srv</span><br><span class="line">dr-xr-xr-x  13 root root   0 Nov 29 13:52 sys</span><br><span class="line">drwxrwxrwt   7 root root 171 Sep 15 14:17 tmp</span><br><span class="line">drwxr-xr-x  12 root root 144 Sep 15 14:17 usr</span><br><span class="line">drwxr-xr-x  20 root root 262 Sep 15 14:17 var</span><br></pre></td></tr></table></figure>
<p>测试ENTRYPOINT</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">编写dockerfile文件</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# vim testEntryPointDockerFile</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# ls</span><br><span class="line">myFirstDockerFile  testCmdDockerFile  testEntryPointDockerFile</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# cat testEntryPointDockerFile </span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta"># </span><span class="language-bash">开始创建镜像</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# docker build -f testEntryPointDockerFile -t entrypointdocker:1.0 .</span><br><span class="line">Sending build context to Docker daemon  4.096kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">5d0da3dc9764</span></span><br><span class="line">Step 2/2 : ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> b6acadcc217a</span></span><br><span class="line">Removing intermediate container b6acadcc217a</span><br><span class="line"><span class="meta"> ---&gt; </span><span class="language-bash">d6152ef85374</span></span><br><span class="line">Successfully built d6152ef85374</span><br><span class="line">Successfully tagged entrypointdocker:1.0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">此时我们直接进行run</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# docker run d6152ef85374</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">那么我们再进行一下测试</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">我们的命令，是直接拼接在我们得ENTRYPOINT命令后面的</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ dockerfile]# docker run d6152ef85374 -l</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x   1 root root   6 Dec  1 13:26 .</span><br><span class="line">drwxr-xr-x   1 root root   6 Dec  1 13:26 ..</span><br><span class="line">-rwxr-xr-x   1 root root   0 Dec  1 13:26 .dockerenv</span><br><span class="line">lrwxrwxrwx   1 root root   7 Nov  3  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root 340 Dec  1 13:26 dev</span><br><span class="line">drwxr-xr-x   1 root root  66 Dec  1 13:26 etc</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 home</span><br><span class="line">lrwxrwxrwx   1 root root   7 Nov  3  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root   9 Nov  3  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------   2 root root   6 Sep 15 14:17 lost+found</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 media</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 mnt</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 opt</span><br><span class="line">dr-xr-xr-x 104 root root   0 Dec  1 13:26 proc</span><br><span class="line">dr-xr-x---   2 root root 162 Sep 15 14:17 root</span><br><span class="line">drwxr-xr-x  11 root root 163 Sep 15 14:17 run</span><br><span class="line">lrwxrwxrwx   1 root root   8 Nov  3  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root   6 Nov  3  2020 srv</span><br><span class="line">dr-xr-xr-x  13 root root   0 Nov 29 13:52 sys</span><br><span class="line">drwxrwxrwt   7 root root 171 Sep 15 14:17 tmp</span><br><span class="line">drwxr-xr-x  12 root root 144 Sep 15 14:17 usr</span><br><span class="line">drwxr-xr-x  20 root root 262 Sep 15 14:17 var</span><br><span class="line"><span class="meta">#</span><span class="language-bash">我们此时发现，这个命令是最佳到我们需要执行的命令后面的</span></span><br></pre></td></tr></table></figure>
<p>Dockerfile中很多命令都十分的相似，我们需要了解它们的区别，我们最好的学习就是对比他们然后测试效果！</p>
<h3 id="8-6-实战：tomcat镜像"><a href="#8-6-实战：tomcat镜像" class="headerlink" title="8.6 实战：tomcat镜像"></a>8.6 实战：tomcat镜像</h3><p>1、准备镜像文件</p>
<p>准备<code>tomcat</code> 和<code>jdk</code>到当前目录，编写好<code>README.md</code> 文件。</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207094520680.png" alt="image-20211207094520680"></p>
<p>2、编写dokerfile，官方命令为<code>Dockerfile</code>,在我们build的时候会自动寻找这个文件，就不需要-f指定指定的dockerfile文件路径！</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FROM centos   #初始化镜像源</span><br><span class="line">MAINTAINER liuhuanhuan&lt;liuhuanhuan96@163.com&gt;   #作者，邮箱</span><br><span class="line">COPY README.md /usr/local/README.md    #文件拷贝</span><br><span class="line">ADD apache-tomcat-9.0.55.tar.gz /usr/local/   #新增tomcat文件 会自动解压到我们的容器当中</span><br><span class="line">ADD jdk-8u311-linux-x64.tar.gz /usr/local/    #新增jdk文件 会自动解压到我们的容器当中</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim     #命令安装</span><br><span class="line">ENV MYPATH /usr/local    # 配置基础环境</span><br><span class="line">WORKDIR $MYPATH    #配置工作目录</span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_311    # 配置java环境</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.55   # 配置tomcat环境</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080   #暴露外部端口</span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.55/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.55/logs/catalina.out  </span><br></pre></td></tr></table></figure>
<p>3、构建镜像</p>
<p><code>因为dockerfile命名使用默认命名 因此不用使用-f 指定文件</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker build -t diytomcat .</span><br></pre></td></tr></table></figure>
<p>4、启动镜像</p>
<ul>
<li>-d 后台启动</li>
<li>-p 指定外部访问接口</li>
<li>-v 数据卷挂载</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker run -d -p 9090:8080 --name tomcat01 -v /home/tomcat/test:/usr/local/apache-tomcat-9.0.55/webapps/test -v /home/tomcat/logs/:/usr/local/apache-tomcat-9.0.55/logs diytomcat</span><br></pre></td></tr></table></figure>
<p>5、访问测试</p>
<p>当然，此时如果我们需要访问的话，我们还需要去阿里云配置下我们的网络安全组，不然我们是无法正常访问外部接口的</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207100331133.png" alt="image-20211207100331133"></p>
<p>6、发布项目(由于做了卷挂载，我们直接在本地编写项目就可以发布了！)</p>
<p>我们在我们的外部<code>/home/tomcat/test</code>目录下新增几个文件</p>
<p>style.css</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#5e3434</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.content</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>);</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">160px</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">font-family</span>: <span class="string">&quot;Lato&quot;</span>, sans-serif;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">35px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.content_container</span> &#123;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.content_container</span><span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;[&quot;</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.content_container</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.content_container</span><span class="selector-pseudo">:before</span>, <span class="selector-class">.content_container</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#a04d16</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">42px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line">    -webkit-<span class="attribute">animation-name</span>: opacity;</span><br><span class="line">            <span class="attribute">animation-name</span>: opacity;</span><br><span class="line">    -webkit-<span class="attribute">animation-duration</span>: <span class="number">2s</span>;</span><br><span class="line">            <span class="attribute">animation-duration</span>: <span class="number">2s</span>;</span><br><span class="line">    -webkit-<span class="attribute">animation-iteration-count</span>: infinite;</span><br><span class="line">            <span class="attribute">animation-iteration-count</span>: infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.content_container_text</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: inline;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.content_container_list</span> &#123;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">110px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: left;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">    -webkit-<span class="attribute">animation-name</span>: change;</span><br><span class="line">            <span class="attribute">animation-name</span>: change;</span><br><span class="line">    -webkit-<span class="attribute">animation-duration</span>: <span class="number">10s</span>;</span><br><span class="line">            <span class="attribute">animation-duration</span>: <span class="number">10s</span>;</span><br><span class="line">    -webkit-<span class="attribute">animation-iteration-count</span>: infinite;</span><br><span class="line">            <span class="attribute">animation-iteration-count</span>: infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.content_container_list_item</span> &#123;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@-webkit-keyframes</span> opacity &#123;</span><br><span class="line">    <span class="number">0%</span>, <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">50%</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> opacity &#123;</span><br><span class="line">    <span class="number">0%</span>, <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">50%</span> &#123;</span><br><span class="line">        <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@-webkit-keyframes</span> change &#123;</span><br><span class="line">    <span class="number">0%</span>, <span class="number">12.66%</span>, <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">16.66%</span>, <span class="number">29.32%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, -<span class="number">25%</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">33.32%</span>, <span class="number">45.98%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, -<span class="number">50%</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">49.98%</span>, <span class="number">62.64%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, -<span class="number">75%</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">66.64%</span>, <span class="number">79.3%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, -<span class="number">50%</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">83.3%</span>, <span class="number">95.96%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, -<span class="number">25%</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> change &#123;</span><br><span class="line">    <span class="number">0%</span>, <span class="number">12.66%</span>, <span class="number">100%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">16.66%</span>, <span class="number">29.32%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, -<span class="number">25%</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">33.32%</span>, <span class="number">45.98%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, -<span class="number">50%</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">49.98%</span>, <span class="number">62.64%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, -<span class="number">75%</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">66.64%</span>, <span class="number">79.3%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, -<span class="number">50%</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="number">83.3%</span>, <span class="number">95.96%</span> &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">translate3d</span>(<span class="number">0</span>, -<span class="number">25%</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>一个动态的文字框动画<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./style.css&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://fonts.googleapis.com/css?family=Lato&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content_container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;content_container_text&quot;</span>&gt;</span></span><br><span class="line">      Hello</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;content_container_list&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;content_container_list_item&quot;</span>&gt;</span>world !<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;content_container_list_item&quot;</span>&gt;</span>friend !<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;content_container_list_item&quot;</span>&gt;</span>users !<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;content_container_list_item&quot;</span>&gt;</span>everybody !<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们再去我们刚刚启动的容器中去查看，是否有文件新增：</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207100738296.png" alt="image-20211207100738296"></p>
<p>此时我们发现有文件新增，那么我们就可以直接在外部访问了。我们看下效果。</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207100834004.png" alt="image-20211207100834004"></p>
<p>此时我们发现：项目部署成功，可以直接访问！nice!!!部署项目的这部分，我们可以暂时先告一段落了。</p>
<p>我们以后开发的步骤：需要掌握Dockerfile的编写！我们之后的一切都是使用docker镜像来发布运行！</p>
<h3 id="8-7-发布自己的镜像"><a href="#8-7-发布自己的镜像" class="headerlink" title="8.7 发布自己的镜像"></a>8.7 发布自己的镜像</h3><p>1、地址 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hub.docker.com/注册账号">https://hub.docker.com/注册账号</a></p>
<p>2、确定这个账号可以登录</p>
<p>3、登录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ test]# docker login --help </span><br><span class="line"></span><br><span class="line">Usage:  docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">Log in to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ test]# docker login -u liuhuanhuan963019</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>
<p>出现如上即可表示我们登录成功了！！！</p>
<p>4、提交 push镜像.</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">push自己的镜像到服务器上！</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ test]# docker push diytomcat</span><br><span class="line">Using default tag: latest</span><br><span class="line">The push refers to repository [docker.io/library/diytomcat]</span><br><span class="line">48634880c0b2: Preparing </span><br><span class="line">5a27e124f752: Preparing </span><br><span class="line">280b959488cc: Preparing </span><br><span class="line">ce96dfda7353: Preparing </span><br><span class="line">74ddd0ec08fa: Preparing </span><br><span class="line">denied: requested access to the resource is denied</span><br></pre></td></tr></table></figure>
<p>此时提示我们<code>push</code>失败,那么我们去修改下我们的镜像配置，我们给我们的容器新增一个<code>tag</code>标签</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ test]# docker tag df03f9daf7fc liuhuanhuan963019/diytomcat:1.0</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ test]# docker images</span><br><span class="line">REPOSITORY                    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">diytomcat                     latest    df03f9daf7fc   3 days ago     677MB</span><br><span class="line">liuhuanhuan963019/diytomcat   1.0       df03f9daf7fc   3 days ago     677MB</span><br><span class="line">mysql                         8.0       bbf6571db497   4 days ago     516MB</span><br><span class="line">nginx                         latest    f652ca386ed1   4 days ago     141MB</span><br><span class="line">tomcat                        latest    904a98253fbf   2 weeks ago    680MB</span><br><span class="line">centos                        latest    5d0da3dc9764   2 months ago   231MB</span><br><span class="line">portainer/portainer           latest    580c0e4e98b0   8 months ago   79.1MB</span><br></pre></td></tr></table></figure>
<p>此时我们再去重新提交下看看：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ test]# docker push liuhuanhuan963019/diytomcat:1.0</span><br></pre></td></tr></table></figure>
<p>我们看下效果</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207102352554.png" alt="image-20211207102352554"></p>
<p>此时提交的时候也是一层一层的去进行提交的，我们等待片刻，即可push成功了。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">会发现push不上去，因为如果没有前缀的话默认是push到 官方的library</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">解决方法</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">第一种 build的时候添加你的dockerhub用户名，然后在push就可以放到自己的仓库了</span></span><br><span class="line"><span class="meta">$ </span><span class="language-bash">docker build -t chengcoder/mytomcat:0.1 .</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">第二种 使用docker tag <span class="comment">#然后再次push</span></span></span><br><span class="line"><span class="meta">$ </span><span class="language-bash">docker tag 容器<span class="built_in">id</span> chengcoder/mytomcat:1.0</span> </span><br><span class="line"><span class="meta">#</span><span class="language-bash">然后再次push</span></span><br><span class="line"><span class="meta">$ </span><span class="language-bash">docker push kuangshen/tomcat:1.0</span></span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/5e8f3ade8f7947f2a154c40c4b58d5ca.png" alt="在这里插入图片描述"></p>
<p><strong>提交的时候也是按照镜像的层级来提交的！</strong></p>
<h3 id="8-8-发布阿里云镜像服务上"><a href="#8-8-发布阿里云镜像服务上" class="headerlink" title="8.8 发布阿里云镜像服务上"></a>8.8 发布阿里云镜像服务上</h3><p>1、登录阿里云</p>
<p>2、找到容器镜像服务 之前我们配置过镜像加速，现在我们需要去实际运用下镜像仓库。</p>
<p>3、创建命名空间</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207103148902.png" alt="image-20211207103148902"></p>
<p>4、创建容器镜像</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207103324569.png" alt="image-20211207103324569"></p>
<p>然后选择我们本地仓库就可以了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207103148902.png" alt=""></p>
<p>点开我们查看下具体的具体的使用方式：</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207103438352.png" alt="image-20211207103438352"></p>
<p>看官网 很详细<a target="_blank" rel="noopener external nofollow noreferrer" href="https://cr.console.aliyun.com/repository/">https://cr.console.aliyun.com/repository/</a></p>
<p><code>下面来实战操作下：</code></p>
<ul>
<li>先登录阿里云的镜像服务</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker login --username=最爱吃大米1111 registry.cn-shanghai.aliyuncs.com</span><br></pre></td></tr></table></figure>
<ul>
<li>然后加标签后开始push</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker images</span><br><span class="line">REPOSITORY                    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">diytomcat                     latest    df03f9daf7fc   3 days ago     677MB</span><br><span class="line">liuhuanhuan963019/diytomcat   1.0       df03f9daf7fc   3 days ago     677MB</span><br><span class="line">mysql                         8.0       bbf6571db497   4 days ago     516MB</span><br><span class="line">nginx                         latest    f652ca386ed1   4 days ago     141MB</span><br><span class="line">tomcat                        latest    904a98253fbf   2 weeks ago    680MB</span><br><span class="line">centos                        latest    5d0da3dc9764   2 months ago   231MB</span><br><span class="line">portainer/portainer           latest    580c0e4e98b0   8 months ago   79.1MB</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker tag df03f9daf7fc xxxx:1.0</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207104653247.png" alt="image-20211207104653247"></p>
<p>此时我们就可以看到我们的镜像已经在push了。</p>
<p>具体操作步骤，看下官方文档会有很详细的步骤：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://cr.console.aliyun.com/repository/cn-shanghai/liuhuanhuan963019/liuhuanhuan963019-test/details">https://cr.console.aliyun.com/repository/cn-shanghai/liuhuanhuan963019/liuhuanhuan963019-test/details</a></p>
<h3 id="8-8、小结"><a href="#8-8、小结" class="headerlink" title="8.8、小结"></a>8.8、小结</h3><p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207104948208.png" alt="image-20211207104948208" style="zoom:50%;" /></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207105231039.png" alt="image-20211207105231039" style="zoom:50%;" /></p>
<h2 id="九、Docker网络"><a href="#九、Docker网络" class="headerlink" title="九、Docker网络"></a>九、Docker网络</h2><h3 id="9-1-理解Docker0"><a href="#9-1-理解Docker0" class="headerlink" title="9.1 理解Docker0"></a>9.1 理解Docker0</h3><p>1.清空所有网络</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker rmi -f $(docker images -aq)</span><br></pre></td></tr></table></figure>
<p>获取当前ip地址</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:25:1a:9d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.28.216.81/20 brd 172.28.223.255 scope global dynamic noprefixroute eth0</span><br><span class="line">       valid_lft 314696843sec preferred_lft 314696843sec</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:18:94:19:89 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>
<p><strong>三个网络地址（本机地址、阿里云生成的地址、docker0地址）</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207133046082.png" alt="image-20211207133046082"></p>
<p>此时我们需要去思考一个问题，<code>`docker 是如果处理容器网络访问的？</code></p>
<p>比如我现在有一个tomcat容器，还有一个mysql容器，那么 tomcat中的项目，如何去访问mysql容器中的数据呢，<code>这个链接是写阿里云地址呢，还是写我们的docker地址呢，还是写我们的127.0.0.1呢，我们需要来多多观察下。</code>我们研究docker网络，主要就是研究这部分的内容的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207134445990.png" alt="image-20211207134445990"></p>
<p>现在我们来运行一个简单的容器，然后看下我们的网络地址变化情况,由于官网现实版本tomcat镜像阉割了很多命令，连基础的<code>yum</code>命令都没有了，所以我们还是使用我们之前的镜像来测试下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker exec -it 86f90cc3847b ip addr</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207143132921.png" alt="image-20211207143132921"></p>
<p>在我们启动镜像之后，我们看到了一个<code>`etho@if175</code>这样的 地址，这个就是docker给他分配的地址！每个容器都会有一个这样的地址</p>
<p>思考一个问题，linux能不能ping同内部的网络呢？</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# ping 172.17.0.2</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207143420110.png" alt="image-20211207143420110"></p>
<p>此时发现我们可以成功的ping通！！！。</p>
<p><strong>linux是可以ping通docker地址内部地</strong>址</p>
<p><strong>原理</strong></p>
<p>1、我们每启动一个docker容器，Docker就会给docker容器分配一个ip，我们只要安装了docker，就会有一个docker0桥接模式，使用的技术是 veth-pair 技术！</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/bakari/p/10613710.html">https://www.cnblogs.com/bakari/p/10613710.html</a></p>
<p>再次测试ip addr</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207143650194.png" alt=""></p>
<p>2 、在启动一个容器测试，发现又多了一对网络</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker run -d -P --name tomcat02 e2babf72ba72 </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207144013658.png" alt="image-20211207144013658"></p>
<p>我们发现这个容器带来网卡，都是一对对的</p>
<p><strong>veth-pair</strong> 就是一对的虚拟设备接口，他们都是成对出现的，一端连着协议，一端彼此相连，正因为有这个特性 veth-pair 充当一个桥梁，连接各种虚拟网络设备的OpenStac,Docker容器之间的连接，OVS的连接，都是使用evth-pair技术</p>
<p>3、我们来测试下tomcat01和tomcat02是否可以ping通</p>
<p><strong>通过tomcat01来ping tomcat02</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207144410622.png" alt="image-20211207144410622"></p>
<p><strong>通过tomcat02来ping tomcat01</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207144455274.png" alt="image-20211207144455274"></p>
<p>此时我们发现都可以互相ping通。</p>
<p><strong>容器与容器之间是可以互相ping通的</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/cce22e1584b349f69aa07c6a01ad9d1e.png" alt="在这里插入图片描述"></p>
<p><strong>结论</strong>：tomcat01和tomcat02公用一个路由器，docker0。</p>
<p>所有的容器不指定网络的情况下，都是docker0路由的，docker会给我们的容器分配一个默认的可用ip。</p>
<p>那么我们的这个可用ip有多少个呢。</p>
<p>小结： Docker使用的是Linux的桥接，宿主机是一个Docker容器的网桥 docker0，容器之间想要链接就需要通过vet-pair进行转发，访问。</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/690de016b877403296c0ec5edd23e370.png" alt="在这里插入图片描述"></p>
<p><strong>Docker 中的所有的网络接口都是虚拟的。虚拟的转发效率高！</strong></p>
<p>只要容器删除，对应网桥一对就没了！</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/%E5%90%83%E6%92%92%E7%9A%84%E6%93%A6%E6%93%A6%E6%93%A6w5.png" alt="image-20211207145640865"></p>
<p>思考一个场景：我们编写了一个微服务，database url=ip: ，项目不重启，数据库ip换了，我们希望可以处理这个问题，可以通过名字来进行访问容器？</p>
<h3 id="9-2-—link"><a href="#9-2-—link" class="headerlink" title="9.2    —link"></a>9.2    —link</h3><p>思考一个场景：我们编写了一个微服务，database url=ip: ，项目不重启，数据库ip换了，我们希望可以处理这个问题，可以通过名字来进行访问容器？</p>
<p>我们使用刚刚创建的两个容器，使用tomcat01 来 ping tomcat02看看，是否能ping通呢？</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker exec -it tomcat01 ping tomcat02</span><br><span class="line">ping: tomcat02: Name or service not known</span><br></pre></td></tr></table></figure>
<p>此时我们发现根本ping不同，那我们尝试着去解决这个问题。</p>
<p>我们重新启动一个tomcat容器,使用<code>--link</code>的方式进行启动，然后尝试去ping下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker run -d -P --name tomcat03 --link tomcat02 diytomcat</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207150232419.png" alt="image-20211207150232419"></p>
<p>此时我们惊奇的发现，可以通过来ping通了！！！之后我们就可以通过<code>--link</code>的方式进行操作，就不要操作ip地址，即可访问了</p>
<p>此时我们启动<code>tomcat03</code>的时候，我们<code>–link</code>链接的是<code>`tomcat02</code>,所以我们可以通过<code>tomcat03</code>来直接<code>ping</code> <code>tomcat02</code>,那么如果我们进行反向操作呢？尝试下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker exec -it tomcat02 ping tomcat03</span><br><span class="line">ping: tomcat03: Name or service not known</span><br></pre></td></tr></table></figure>
<p>此时我们发现，反向<code>`ping</code>的时候根本ping不通，我们去查看下为什么？通过<code>network</code>可以查看</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker network --help</span><br><span class="line"></span><br><span class="line">Usage:  docker network COMMAND</span><br><span class="line"></span><br><span class="line">Manage networks</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  connect     Connect a container to a network</span><br><span class="line">  create      Create a network</span><br><span class="line">  disconnect  Disconnect a container from a network</span><br><span class="line">  inspect     Display detailed information on one or more networks</span><br><span class="line">  ls          List networks</span><br><span class="line">  prune       Remove all unused networks</span><br><span class="line">  rm          Remove one or more networks</span><br><span class="line"></span><br><span class="line">Run &#x27;docker network COMMAND --help&#x27; for more information on a command.</span><br></pre></td></tr></table></figure>
<p>我们可以用通过ls查看我们前的一些网络信息。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE   </span><br><span class="line">54e8f3e9829b   bridge    bridge    local   #这是系统默认的桥接的 这个就是docker0</span><br><span class="line">fec761935499   host      host      local</span><br><span class="line">af96498edc1e   none      null      local</span><br></pre></td></tr></table></figure>
<p>我们来看下这个第一个<code>bridge</code>的这个网络配置</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207151215689.png" alt="image-20211207151215689"></p>
<blockquote>
<p>以下是我们的启动的3个容器的地址，在我们没有指定ip的时候，会给我们的容器<code>自动分配ip</code>地址。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207151316863.png" alt=""></p>
<p>刚刚我们启动tomcat03的时候通过<code>--link</code>的方式绑定了我们的<code>tomcat02</code>。</p>
<p>本质上其实就是在我们的<code>tomcat03</code>当中配置了<code>`tomcat02</code>的配置，让我们去容器内部去一探究竟。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker exec -it tomcat03 cat /etc/hosts</span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.17.0.3	tomcat02 8f923b56b788</span><br><span class="line">172.17.0.4	90370f44e98a</span><br></pre></td></tr></table></figure>
<p>此时我们惊奇的发现，在我们的<code>tomcat03</code>容器内部的<code>hosts</code>文件，自动配置了<code>tomcat02</code>的<code>ip地址</code>，直接写死了地址，所以说我们<code>tomcat03</code> <code>ping</code> <code>tomcat02</code>的时候，可以直接ping通.</p>
<font size=14><strong>**本质探究:**</strong></font>`--link` 本质就是在hosts配置中`tomcat02`的映射`ip`地址。

<font size=5 color='red'><strong>但是现在使用Docker已经不建议使用–link了！</strong></font>

<font size=5 color='purple'><strong>我们需要的是自定义网络！,已经不在适合docker0了！！！</strong></font>

<font size=5 color='purple'><strong>主要是因为docker0，已经不在支持容器名进行访问了，我们只需要定义一个网络，让他支持容器名访问就可以了！！！</strong></font>

<h3 id="9-3-自定义网络"><a href="#9-3-自定义网络" class="headerlink" title="9.3 自定义网络"></a>9.3 自定义网络</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$ </span><span class="language-bash">docker network --<span class="built_in">help</span></span></span><br><span class="line">connect -- Connect a container to a network</span><br><span class="line">create -- Creates a new network with a name specified by the</span><br><span class="line">disconnect -- Disconnects a container from a network</span><br><span class="line">inspect -- Displays detailed information on a network</span><br><span class="line">ls -- Lists all the networks created by the user</span><br><span class="line">prune -- Remove all unused networks</span><br><span class="line">rm -- Deletes one or more networks</span><br></pre></td></tr></table></figure>
<p>上一节中所提到的<code>--link</code>和本章节中所提到的自定义网络，我们都叫做容器互联技术。</p>
<p>我们现在来查看下所有的docker网络</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">54e8f3e9829b   bridge    bridge    local</span><br><span class="line">fec761935499   host      host      local</span><br><span class="line">af96498edc1e   none      null      local</span><br></pre></td></tr></table></figure>
<p><strong>网络模式</strong></p>
<p><code>bridge</code> ：<font size=6 color="red">桥接 docker（默认，自己创建也是使用bridge模式）  主要用的是这个桥接模式</font></p>
<p><code>none</code> ：<strong>不配置网络，一般不用</strong></p>
<p><code>host</code> ：和宿主机共享网络</p>
<p><code>container</code> ：容器网络连通（用得少！局限很大）</p>
<p><strong>测试桥接模式</strong></p>
<p>测试之前，我们先删除掉我们全部的容器，保证环境干净</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker rm -f $(docker ps -aq)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207154749985.png" alt="image-20211207154749985"></p>
<p><strong>我们直接启动的命令 —net bridge,而这个就是我们得docker0</strong>  <code>bridge就是我们所说的docker0</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -P --name tomcat01 --net bridge tomcat</span><br></pre></td></tr></table></figure>
<p><strong>等价于 =&gt;</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -d -P --name tomcat01  tomcat</span><br></pre></td></tr></table></figure>
<p>两种实现方式，最后的效果是一样的 </p>
<p>docker0特点：<strong>默认，域名不能访问。 —link可以打通连接，但是很麻烦！</strong></p>
<p>我们可以 自定义一个网络，之后我们的服务，就可以在我们的自定义网络下进行使用</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>--driver</code>       bridge</p>
</li>
<li><p><code>--subnet</code>       192.168.0.0/16  子网     (192.168.0.2-192.168.255.255)</p>
</li>
<li><p><code>--gateway</code>      192.168.0.1  网关</p>
</li>
</ul>
<p>这个192.168.0.1就类似我们家中所使用的路由器的配置，这就是我们网关的一个概念。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line">3736e3efc939650ab2bb0a082c1a556ba188af22c0ce5747545ef95f9130d691</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">54e8f3e9829b   bridge    bridge    local</span><br><span class="line">fec761935499   host      host      local</span><br><span class="line">3736e3efc939   mynet     bridge    local</span><br><span class="line">af96498edc1e   none      null      local</span><br></pre></td></tr></table></figure>
<p>此时发现，我们新建的网络已经创建成功了！！！</p>
<p>我们查看下我们的自己的网络的相关配置：</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207155859336.png" alt="image-20211207155859336"></p>
<p>既然我们创建了自己的网络，那我们也要来使用下，下面我们来创建两个容器，来看下我们的网络配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker run -d -P --name tomcat01 --net mynet diytomcat</span><br><span class="line">e4de5660a3d23287e71b8ff6702e052b146d5626921328b840ae5172bc807dcb</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker run -d -P --name tomcat02 --net mynet diytomcat</span><br><span class="line">78fddd1c9ecc95654fb9dd498738d82004d2617ab65f0d5000098348a24c5baa</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker network inspect mynet </span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;3736e3efc939650ab2bb0a082c1a556ba188af22c0ce5747545ef95f9130d691&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-12-07T15:55:50.112416535+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;78fddd1c9ecc95654fb9dd498738d82004d2617ab65f0d5000098348a24c5baa&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;e4209762b16c66e8b78dda8cb0014fcdcce447c591ff21ba9fd4881577bc2d68&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;e4de5660a3d23287e71b8ff6702e052b146d5626921328b840ae5172bc807dcb&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;f8f96a34ec4a8967a978f1dcef5a4ec6fae484a760d5d54e4a27bb0048c6b9e0&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>此时我们可以清楚的看到，我们指定的地址下面，就有了2个容器。一个是tomcat01 ,一个是tomcat02</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207160258812.png" alt="image-20211207160258812"></p>
<p>我们此时测试下，通过<code>tomcat01</code>来<code>ping</code> <code>tomcat02</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker exec -it tomcat01 ping 192.168.0.3 -c 5</span><br><span class="line">PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.082 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=2 ttl=64 time=0.075 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=3 ttl=64 time=0.074 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=4 ttl=64 time=0.078 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=5 ttl=64 time=0.076 ms</span><br><span class="line"></span><br><span class="line">--- 192.168.0.3 ping statistics ---</span><br><span class="line">5 packets transmitted, 5 received, 0% packet loss, time 4091ms</span><br><span class="line">rtt min/avg/max/mdev = 0.074/0.077/0.082/0.003 ms</span><br></pre></td></tr></table></figure>
<p><strong>此时我们通过ping容器名称来尝试看下，在我们没有指定<code>--link</code>的情况下，是否可以<code>ping</code> 通过呢?</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker exec -it tomcat01 ping tomcat02 -c 5</span><br><span class="line">PING tomcat02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.063 ms</span><br><span class="line">64 bytes from tomcat02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.085 ms</span><br><span class="line">64 bytes from tomcat02.mynet (192.168.0.3): icmp_seq=3 ttl=64 time=0.094 ms</span><br><span class="line">64 bytes from tomcat02.mynet (192.168.0.3): icmp_seq=4 ttl=64 time=0.081 ms</span><br><span class="line">64 bytes from tomcat02.mynet (192.168.0.3): icmp_seq=5 ttl=64 time=0.080 ms</span><br><span class="line"></span><br><span class="line">--- tomcat02 ping statistics ---</span><br><span class="line">5 packets transmitted, 5 received, 0% packet loss, time 4118ms</span><br><span class="line">rtt min/avg/max/mdev = 0.063/0.080/0.094/0.014 ms</span><br></pre></td></tr></table></figure>
<p><strong>此时我们发现，依然可以ping通过，这就是使用自定义网络之后的好处！！！</strong></p>
<font size=5 color="green">总结：</font>在自定义的网络下，服务可以互相ping通，不用使用–link

​                我们自定义的网络docker当我们维护好了对应的关系，推荐我们平时这样使用网络！

**好处：**

- `redis` -不同的集群使用不同的网络，保证集群是安全和健康的
- `mysql`-不同的集群使用不同的网络，保证集群是安全和健康的

<img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207161556612.png" alt="image-20211207161556612" style="zoom:50%;" />

### 9.4 网络连通

此时我们考虑一个，使用`tomcat-01`来`ping` `tomcat-net-01`是否可以ping通呢？

![image-20211207162001076](https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207162001076.png)

**实际情况时根本ping不同，这是一个不现实的问题！！！**

那我们此时怎么去实现这个操作呢。我们`--help`查看下

![image-20211207162319859](https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207162319859.png)

这就是我们链接容器的一个核心！！！

![image-20211207162744283](https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207162744283.png)

**此时我们需要去测试连通不同网络下的容器！！！**

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker network connect mynet tomcat-01</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker network inspect mynet </span><br></pre></td></tr></table></figure>

此时我们看下运行效果:

![image-20211207163404340](https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207163404340.png)

此时我们搭建连通之后，在我们的自定义网络，我们发现，多了一个我们定义的`tomcat-01`。连通就是将我们的`tomcat-01`加入到我们的自定义的网络当中了！！！！

官方俗称：一个容器，两个ip地址。！！！

**简单打个比方，我们现在使用的这个阿里云服务器，有两个ip地址，一个是公网ip，一个是内网ip**

此时我们再去ping尝试下看看:

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker exec -it tomcat-01 ping tomcat01 -c 5</span><br><span class="line">PING tomcat01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.083 ms</span><br><span class="line">64 bytes from tomcat01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.077 ms</span><br><span class="line">64 bytes from tomcat01.mynet (192.168.0.2): icmp_seq=3 ttl=64 time=0.105 ms</span><br><span class="line">64 bytes from tomcat01.mynet (192.168.0.2): icmp_seq=4 ttl=64 time=0.080 ms</span><br><span class="line">64 bytes from tomcat01.mynet (192.168.0.2): icmp_seq=5 ttl=64 time=0.089 ms</span><br><span class="line"></span><br><span class="line">--- tomcat01 ping statistics ---</span><br><span class="line">5 packets transmitted, 5 received, 0% packet loss, time 4105ms</span><br><span class="line">rtt min/avg/max/mdev = 0.077/0.086/0.105/0.015 ms</span><br></pre></td></tr></table></figure>

成功ping通了！！！！

我们在测试下tomcat-02看看，由于我们没有连通网络，理论上是没法打通的，我们看下实际的效果：

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker exec -it tomcat-02 ping tomcat01 -c 5</span><br><span class="line">ping: tomcat01: Name or service not known</span><br></pre></td></tr></table></figure>

连通失败！！！

<font size=6 color="purple">结论：假设要跨网络操作别人，就需要使用 docker network connect 连通！</font>



<h3 id="9-5-Redis集群实战部署"><a href="#9-5-Redis集群实战部署" class="headerlink" title="9.5 Redis集群实战部署"></a>9.5 Redis集群实战部署</h3><p><code>用的是分片集群  +  高可用+ 负载均衡</code></p>
<p>我们创建6台Redis主机，3台主机，3台从机，为了实现高可用，下面就是做一个备份了，一旦我们的主机挂掉了，那么我们的从机就需要顶上去，代替我们的主机</p>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207164511827.png" alt="image-20211207164511827" style="zoom:50%;" /></p>
<p>6个容器，单个启动太慢了，我们选择写一个shell脚本来一键启动：</p>
<p>既然我们要搭建集群的话，那么我们就需要去新建一个Redis的网卡,在此之前，建议还是先清空本地全部的容器，不然1核2G的服务器，卡死可就不好玩咯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker rm -f $(docker ps -aq)</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker network create redis --subnet 172.38.0.0/16</span><br><span class="line">5d1b3390482eb00db03573a22da4ad9dfab72ea08e0c0364b6c9be1468f3b43d</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">54e8f3e9829b   bridge    bridge    local</span><br><span class="line">fec761935499   host      host      local</span><br><span class="line">3736e3efc939   mynet     bridge    local</span><br><span class="line">af96498edc1e   none      null      local</span><br><span class="line">5d1b3390482e   redis     bridge    local</span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ tomcat]# docker network inspect redis</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;redis&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;5d1b3390482eb00db03573a22da4ad9dfab72ea08e0c0364b6c9be1468f3b43d&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-12-07T16:51:46.267025951+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;172.38.0.0/16&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>此时我们可以看到，我们新建的这个网卡下面是没有一个网络的！！！现在我们需要区新建容器。</p>
<p>由于Redis我们需要去配置配置文件，我们现在写一个脚本一键去配置：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">通过脚本创建六个redis配置</span></span><br><span class="line">for port in $(seq 1 6);\</span><br><span class="line">do \</span><br><span class="line">mkdir -p /mydata/redis/node-$&#123;port&#125;/conf</span><br><span class="line">touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">cat &lt;&lt; EOF &gt;&gt; /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">port 6379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>执行完脚本之后，我们去看下文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ redis]# ll</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 3 root root 18 Dec  7 19:14 node-1</span><br><span class="line">drwxr-xr-x 3 root root 18 Dec  7 19:14 node-2</span><br><span class="line">drwxr-xr-x 3 root root 18 Dec  7 19:14 node-3</span><br><span class="line">drwxr-xr-x 3 root root 18 Dec  7 19:14 node-4</span><br><span class="line">drwxr-xr-x 3 root root 18 Dec  7 19:14 node-5</span><br><span class="line">drwxr-xr-x 3 root root 18 Dec  7 19:14 node-6</span><br></pre></td></tr></table></figure>
<p>通过脚本启动6个redis服务：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">通过脚本运行六个redis</span></span><br><span class="line">for port in $(seq 1 6);\</span><br><span class="line">docker run -p 637$&#123;port&#125;:6379 -p 1667$&#123;port&#125;:16379 --name redis-$&#123;port&#125; \</span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/data:/data \</span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.1$&#123;port&#125; redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="language-bash">单个依次启动</span></span><br><span class="line">docker run -p 6371:6379 -p 16671:16379 --name redis-1 \</span><br><span class="line">-v /mydata/redis/node-1/data:/data \</span><br><span class="line">-v /mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6372:6379 -p 16672:16379 --name redis-2 \</span><br><span class="line">-v /mydata/redis/node-2/data:/data \</span><br><span class="line">-v /mydata/redis/node-2/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.12 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6373:6379 -p 16673:16379 --name redis-3 \</span><br><span class="line">-v /mydata/redis/node-3/data:/data \</span><br><span class="line">-v /mydata/redis/node-3/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.13 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6374:6379 -p 16674:16379 --name redis-4 \</span><br><span class="line">-v /mydata/redis/node-4/data:/data \</span><br><span class="line">-v /mydata/redis/node-4/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.14 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6375:6379 -p 16675:16379 --name redis-5 \</span><br><span class="line">-v /mydata/redis/node-5/data:/data \</span><br><span class="line">-v /mydata/redis/node-5/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.15 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6376:6379 -p 16676:16379 --name redis-6 \</span><br><span class="line">-v /mydata/redis/node-6/data:/data \</span><br><span class="line">-v /mydata/redis/node-6/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.16 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br></pre></td></tr></table></figure>
<p>此时我们看到我们所有的服务已经全部启动起来了！！！</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ redis]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                    COMMAND                  CREATED              STATUS              PORTS                                              NAMES</span><br><span class="line">b02ca37755b1   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   3 seconds ago        Up 3 seconds        0.0.0.0:6376-&gt;6379/tcp, 0.0.0.0:16676-&gt;16379/tcp   redis-6</span><br><span class="line">b744ec0c8e7b   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   35 seconds ago       Up 34 seconds       0.0.0.0:6375-&gt;6379/tcp, 0.0.0.0:16675-&gt;16379/tcp   redis-5</span><br><span class="line">e2d30288447f   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   About a minute ago   Up About a minute   0.0.0.0:6374-&gt;6379/tcp, 0.0.0.0:16674-&gt;16379/tcp   redis-4</span><br><span class="line">cb8fcaf83120   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   About a minute ago   Up About a minute   0.0.0.0:6373-&gt;6379/tcp, 0.0.0.0:16673-&gt;16379/tcp   redis-3</span><br><span class="line">b88c1bbfb253   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   2 minutes ago        Up 2 minutes        0.0.0.0:6372-&gt;6379/tcp, 0.0.0.0:16672-&gt;16379/tcp   redis-2</span><br><span class="line">2c694e4bde3b   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   4 minutes ago        Up 4 minutes        0.0.0.0:6371-&gt;6379/tcp, 0.0.0.0:16671-&gt;16379/tcp   redis-1</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"> #</span><span class="language-bash">redis默认没有bash</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker exec -it redis-1 /bin/sh</span><br><span class="line">/data # ls</span><br><span class="line">appendonly.aof  nodes.conf</span><br></pre></td></tr></table></figure>
<p>此时我们成功的进入到我们的redis-1里面了</p>
<p>然后依次创建集群：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">创建集群</span></span><br><span class="line">redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207193333326.png" alt="image-20211207193333326"></p>
<p>出现如下即表示集群配置成功！！！</p>
<p>我们看下集群的相关配置：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">通过redis-cli -c 进入到集群当中来</span></span><br><span class="line">/data # redis-cli -c</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; cluster info</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_ping_sent:328</span><br><span class="line">cluster_stats_messages_pong_sent:322</span><br><span class="line">cluster_stats_messages_sent:650</span><br><span class="line">cluster_stats_messages_ping_received:317</span><br><span class="line">cluster_stats_messages_pong_received:328</span><br><span class="line">cluster_stats_messages_meet_received:5</span><br><span class="line">cluster_stats_messages_received:650</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; cluster nodes</span><br><span class="line">46342612ff91a491c74f899d25cc7e1956c435f4 172.38.0.11:6379@16379 myself,master - 0 1638876972000 1 connected 0-5460</span><br><span class="line">cc56770681f898eb9939649e97b405e52b7bac9f 172.38.0.12:6379@16379 master - 0 1638876972977 2 connected 5461-10922</span><br><span class="line">90c01415ccf6437c161840d55a016159cd3f2169 172.38.0.13:6379@16379 master - 0 1638876973078 3 connected 10923-16383</span><br><span class="line">98d60136a3e19f7a324680cf27a81a481d053785 172.38.0.15:6379@16379 slave 46342612ff91a491c74f899d25cc7e1956c435f4 0 1638876971474 5 connected</span><br><span class="line">b097c919d8011f4242536a195d42bc1afabba196 172.38.0.16:6379@16379 slave cc56770681f898eb9939649e97b405e52b7bac9f 0 1638876971976 6 connected</span><br><span class="line">dc89dd2075766c12924b0a5b06286eabf308727b 172.38.0.14:6379@16379 slave 90c01415ccf6437c161840d55a016159cd3f2169 0 1638876972000 4 connected</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207193640205.png" alt="image-20211207193640205"></p>
<p>现在我们来做一个简单的数据存储来测试下。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set name &quot;lhh&quot;</span><br><span class="line"><span class="meta">-&gt; </span><span class="language-bash">Redirected to slot [5798] located at 172.38.0.12:6379</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<p>可以看到此时分配的是12这个主机，那么如果当我们12这个主机停掉的时候，那么12的从机，应该顶替上去，这样就可以实现我们的高可用。此时我们在docker中去停掉我们的这个12的这个服务器的端口：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker stop b88c1bbfb253</span><br><span class="line">b88c1bbfb253</span><br></pre></td></tr></table></figure>
<p>此时我们停掉了redis-2这个容器，那么我们刚刚set的这条数据，我们还能拿到吗</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ ~]# docker exec -it redis-1 /bin/sh</span><br><span class="line">/data # redis-cli -c</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="meta">-&gt; </span><span class="language-bash">Redirected to slot [5798] located at 172.38.0.16:6379</span></span><br><span class="line">&quot;lhh&quot;</span><br><span class="line">172.38.0.16:6379&gt; </span><br></pre></td></tr></table></figure>
<p>此时我们停掉了redis-2，那么我们此时对应的丛集redis-6就顶替了之前的redis-2，此时我们依旧是可以查看到我们之前存放的值的。</p>
<p>此时我们再去看下节点：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">172.38.0.16:6379&gt; cluster nodes</span><br><span class="line">cc56770681f898eb9939649e97b405e52b7bac9f 172.38.0.12:6379@16379 master,fail - 1638877301557 1638877300054 2 connected</span><br><span class="line">98d60136a3e19f7a324680cf27a81a481d053785 172.38.0.15:6379@16379 slave 46342612ff91a491c74f899d25cc7e1956c435f4 0 1638877591130 5 connected</span><br><span class="line">b097c919d8011f4242536a195d42bc1afabba196 172.38.0.16:6379@16379 myself,master - 0 1638877589000 7 connected 5461-10922</span><br><span class="line">46342612ff91a491c74f899d25cc7e1956c435f4 172.38.0.11:6379@16379 master - 0 1638877590000 1 connected 0-5460</span><br><span class="line">dc89dd2075766c12924b0a5b06286eabf308727b 172.38.0.14:6379@16379 slave 90c01415ccf6437c161840d55a016159cd3f2169 0 1638877590128 4 connected</span><br><span class="line">90c01415ccf6437c161840d55a016159cd3f2169 172.38.0.13:6379@16379 master - 0 1638877590629 3 connected 10923-16383</span><br></pre></td></tr></table></figure>
<p>此时提示我们的redis-2出现主张，我们的redis-6顶替了之前的主机，</p>
<p>docker搭建redis集群完成！</p>
<p>我们使用docker之后，所有的技术都会慢慢变得简单起来！</p>
<h3 id="9-6-SpingBoot微服务打包Docker镜像"><a href="#9-6-SpingBoot微服务打包Docker镜像" class="headerlink" title="9.6 SpingBoot微服务打包Docker镜像"></a>9.6 SpingBoot微服务打包Docker镜像</h3><p>1.构建SpringBoot镜像</p>
<p>2.打包运行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mvn package</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207201111422.png" alt="image-20211207201111422"></p>
<p>打包成功</p>
<p>3.编写dockerfile</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> *.jar /app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;---server.port=8000&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/app.jar&quot;</span>]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>4、构建镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">1.复制jar和DockerFIle到服务器</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">2.构建镜像</span></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ project]# docker build -t springboot .</span><br></pre></td></tr></table></figure>
<p>5、发布运行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iZuf65oftugvcjgk2jncyeZ project]# docker images</span><br><span class="line">REPOSITORY   TAG                IMAGE ID       CREATED         SIZE</span><br><span class="line">springboot   latest             f4de784883a0   2 minutes ago   661MB</span><br><span class="line">diytomcat    latest             e2babf72ba72   6 hours ago     677MB</span><br><span class="line">centos       latest             5d0da3dc9764   2 months ago    231MB</span><br><span class="line">redis        5.0.9-alpine3.11   3661c84ee9d0   19 months ago   29.8MB</span><br><span class="line">java         8                  d23bdf5b1b1b   4 years ago     643MB</span><br><span class="line"></span><br><span class="line">[root@iZuf65oftugvcjgk2jncyeZ project]# docker run -d -p 8000:8000 --name springboot01 springboot</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/image-20211207203615687.png" alt="image-20211207203615687"></p>
<p>以后我们使用了Docker之后，给别人交付就是一个镜像即可！</p>
<h3 id="9-7-总结"><a href="#9-7-总结" class="headerlink" title="9.7 总结"></a>9.7 总结</h3><h4 id="9-7-1-认识docker"><a href="#9-7-1-认识docker" class="headerlink" title="9.7.1 认识docker"></a>9.7.1 认识docker</h4><p>Docker定义：Docker 是一个开源的应用容器引擎，它可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制（ 沙箱是一个虚拟系统程序，沙箱提供的环境相对于每一个运行的程序都是独立的，而且不会对现有的系统产生影响 ），相互之间不会有任何接口，更重要的是容器性能开销极低。</p>
<p>Docker的优点</p>
<p>Docker 是一个用于开发，交付和运行应用程序的开放平台。Docker 使您能够将应用程序与基础架构分开，从而可以快速交付软件。借助 Docker，您可以与管理应用程序相同的方式来管理基础架构。通过利用Docker 的方法来快速交付，测试和部署代码，您可以大大减少编写代码和在生产环境中运行代码之间的延迟。</p>
<p>Docker应用场景</p>
<ul>
<li>Web 应用的自动化打包和发布。</li>
<li>自动化测试和持续集成、发布。</li>
<li>在服务型环境中部署和调整数据库或其他的后台应用。</li>
<li>从头编译或者扩展现有的 OpenShift 或 Cloud Foundry 平台来搭建自己的 PaaS 环境。</li>
</ul>
<h4 id="9-7-2-Docker容器与虚拟机"><a href="#9-7-2-Docker容器与虚拟机" class="headerlink" title="9.7.2 Docker容器与虚拟机"></a>9.7.2 Docker容器与虚拟机</h4><p>我们用的传统虚拟机如 VMware之类的需要模拟整台机器包括硬件，每台虚拟机都需要有自己的操作系统，虚拟机一旦被开启，预分配给它的资源将全部被占用。每一台虚拟机包括应用，必要的二进制和库，以及一个完整的用户操作系统。</p>
<p>而容器技术是和我们的宿主机共享硬件资源及操作系统，可以实现资源的动态分配。容器包含应用和其所有的依赖包，但是与其他容器共享内核。容器在宿主机操作系统中，在用户空间以分离的进程运行。</p>
<p>容器技术是实现操作系统虚拟化的一种途径，可以让您在资源受到隔离的进程中运行应用程序及其依赖关系。通过使用容器，我们可以轻松打包应用程序的代码、配置和依赖关系，将其变成容易使用的构建块，从而实现环境一致性、运营效率、开发人员生产力和版本控制等诸多目标。容器可以帮助保证应用程序快速、可靠、一致地部署，其间不受部署环境的影响。容器还赋予我们对资源更多的精细化控制能力，让我们的基础设施效率更高。</p>
<p><strong>Docker 属于 Linux 容器的一种封装，提供简单易用的容器使用接口。</strong>它是目前最流行的 Linux容器解决方案。</p>
<p>Docker 将应用程序与该程序的依赖，打包在一个文件里面。运行这个文件，就会生成一个虚拟容器。程序在这个虚拟容器里运行，就好像在真实的物理机上运行一样。有了 Docker ，就不用担心环境问题。</p>
<p>总体来说， Docker 的接口相当简单，用户可以方便地创建和使用容器，把自己的应用放入容器。容器还可以进行版本管理、复制、分享、修改，就像管理普通的代码一样。</p>
<ul>
<li>Docker的几个重要概念，如下图所示：</li>
<li>镜像就类似于在创建虚拟机前需要下载的系统镜像文件，比如iso文件、img文件等一些镜像文件。</li>
</ul>
<blockquote>
<p>镜像是 Docker 运行容器的前提，仓库是存放镜像的场所，可见镜像更是Docker的核心。</p>
</blockquote>
<ul>
<li>容器可以类比于正在运行中的虚拟机。</li>
<li>你可以将你的镜像save为一个tar文件，别人就可以通过load来获取你的镜像。</li>
<li>仓库中则保存了很多公共的常用的镜像，比如常用的JDK镜像、MySQL镜像、tomcat镜像、Ubuntu镜像、ngnix镜像等等。你可以通过pull来拉取获得这些镜像，你也可以自定义一些镜像通过push推送到仓库中。</li>
<li>Dockerfile就是一个build镜像的文件，它描述并指定了应该如何构建一个镜像。</li>
</ul>
<blockquote>
<p>Dockerfile 是自动构建 docker 镜像的配置文件， 用户可以使用 Dockerfile 快速创建自定义的镜像。</p>
<p>Dockerfile 中的命令非常类似于 linux 下的 shell 命令。</p>
<p>一般来说，我们可以将 Dockerfile 分为四个部分：</p>
<ul>
<li>基础镜像(父镜像)信息指令 FROM- 维护者信息指令 MAINTAINER- 镜像操作指令 RUN 、 EVN 、 ADD 和 WORKDIR 等- 容器启动指令 CMD 、 ENTRYPOINT 和 USER 等</li>
</ul>
</blockquote>
<h4 id="9-7-3-Docker-命令"><a href="#9-7-3-Docker-命令" class="headerlink" title="9.7.3 Docker 命令"></a>9.7.3 Docker 命令</h4><div class="table-container">
<table>
<thead>
<tr>
<th>获取镜像</th>
<th>docker pull  镜像名称:版本号</th>
</tr>
</thead>
<tbody>
<tr>
<td>启动容器</td>
<td>1.docker run -d 镜像名称   （后台启动） 2.docker run -it 镜像名称 (进入容器)</td>
</tr>
<tr>
<td>查看容器</td>
<td>1.docker attach 容器id    2.docker exec -it 容器id    /bin/bash</td>
</tr>
<tr>
<td>启动已经停止的容器</td>
<td>docker ps -a</td>
</tr>
<tr>
<td>停止一个容器</td>
<td>docker stop 容器id</td>
</tr>
<tr>
<td>退出容器</td>
<td>ctrl + p +q</td>
</tr>
<tr>
<td>导出容器</td>
<td>docker save</td>
</tr>
<tr>
<td>导入容器</td>
<td>docker load</td>
</tr>
<tr>
<td>删除容器</td>
<td>docker rm -f 容器id</td>
</tr>
<tr>
<td>清理掉所有处于终止状态的容器</td>
<td>docker rm -f $(docker ps-aq)</td>
</tr>
</tbody>
</table>
</div>
<p>2.Docker Web应用<br>            运行一个web应用<br>            以端口5000开启端口<br>            关闭web应用<br>            重启web应用<br>            移除web应用<br>3.Docker 镜像应用<br>            列出镜像列表<br>            获取镜像<br>4.Dockerfile<br>            构建镜像</p>
<h4 id="9-7-4、SpringBoot项目容器化步骤"><a href="#9-7-4、SpringBoot项目容器化步骤" class="headerlink" title="9.7.4、SpringBoot项目容器化步骤"></a>9.7.4、SpringBoot项目容器化步骤</h4><p><code>step1</code>：添加Docker的maven的插件，配置Dockerfile的path；</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;!-- Docker maven plugin --&gt;</span><br><span class="line">&lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;com.spotify&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.4.13&lt;/version&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">        &lt;imageName&gt;$&#123;docker.image.prefix&#125;/$&#123;project.artifactId&#125;</span><br><span class="line">        &lt;/imageName&gt;</span><br><span class="line">        &lt;dockerDirectory&gt;$&#123;project.basedir&#125;/src/main/docker&lt;/dockerDirectory&gt;</span><br><span class="line">        &lt;resources&gt;</span><br><span class="line">            &lt;resource&gt;</span><br><span class="line">                &lt;targetPath&gt;/&lt;/targetPath&gt;</span><br><span class="line">                &lt;directory&gt;$&#123;project.build.directory&#125;&lt;/directory&gt;</span><br><span class="line">                &lt;include&gt;$&#123;project.build.finalName&#125;.jar&lt;/include&gt;</span><br><span class="line">            &lt;/resource&gt;</span><br><span class="line">        &lt;/resources&gt;</span><br><span class="line">    &lt;/configuration&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br></pre></td></tr></table></figure>
<p><code>step2</code>：在配置的Dockerfile的path处添加Dockerfile文件；</p>
<p><code>Step3</code>：文件中添加配置：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FROM openjdk:8-jdk-alpine</span><br><span class="line">VOLUME /tmp</span><br><span class="line"><span class="meta">#</span><span class="language-bash">把当前项目下dockertest-0.0.1-SNAPSHOT.jar 改名为test.jar 添加到镜像中</span></span><br><span class="line">ADD web-app-template-1.0.0.jar test.jar</span><br><span class="line"><span class="meta">#</span><span class="language-bash">指定端口,最好写与项目配置的端口</span></span><br><span class="line">EXPOSE 8080</span><br><span class="line"><span class="meta">#</span><span class="language-bash">在镜像中运行/test.jar包,这样在运行镜像的时候就已经启动好了test.jar</span></span><br><span class="line">ENTRYPOINT [&quot;java&quot;,&quot;-Djava.security.egd=file:/dev/./urandom&quot;,&quot;-jar&quot;,&quot;/test.jar&quot;]</span><br></pre></td></tr></table></figure>
<p><code>Step4</code>：mvn clean package -Dmaven.test.skip=true （表示不执行测试用例，也不编译测试用例类。）</p>
<p><code>step5</code>：mvn package docker:build 打镜像</p>
<p><code>step6</code>：docker images 查看镜像</p>
<p><code>step7</code>：docker run -p 8081:8081 -t springboot/web-app-template 运行</p>
<p><code>step8</code>：查看运行结果：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://localhost:8081/…">http://localhost:8081/…</a>.</p>
<p><code>step9</code>：docker push</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined" rel="external nofollow noreferrer">刘先森</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://hhliu.top/archives/10297.html">http://hhliu.top/archives/10297.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hhliu.top" target="_blank">刘先森の博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Docker/">Docker</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/015.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/./img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/./img/wechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/./img/aipay.png" target="_blank"><img class="post-qr-code-img" src="/./img/aipay.png" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/archives/29076.html"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/016.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">呆完成的hexo博客配置</div></div></a></div><div class="next-post pull-right"><a href="/archives/7478.html"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/007.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SSH登录：WARNING REMOTE HOST IDENTIFICATION HAS CHANGED!</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/./img/head.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">刘先森</div><div class="author-info__description">个人笔记记录</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">109</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">37</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://liuhuanhuan.blog.csdn.net"><i class="fa-solid fa-square-rss"></i><span>关注我</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/liuhuanhuan963019" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:liuhuanhuan96@163.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/2432783449.png" rel="external nofollow noreferrer" target="_blank" title="qq"><i class="fa-brands fa-qq"></i></a><a class="social-icon" href="https://cdn.jsdelivr.net/gh/liuhuanhuan963019/blogPicture/md_photos/wechat.png" rel="external nofollow noreferrer" target="_blank" title="微信"><i class="fa-brands fa-weixin"></i></a><a class="social-icon" href="https://liuhuanhuan.blog.csdn.net" rel="external nofollow noreferrer" target="_blank" title="CSDN"><i class="fa-solid fa-square-rss"></i></a><a class="social-icon" href="https://www.zhihu.com/people/liuhuanhuan963019" rel="external nofollow noreferrer" target="_blank" title="知乎"><i class="fa-brands fa-zhihu"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">如果阅读过程中遇到了问题，请及时评论或者留言，看到了会在第一时间给出回复。若未收到回复，可以加博主vx，方便日后咨询，加以技术讨论。<img src="./img/wechat.png" style="height:250px;width=2500px"></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Docker%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">一、Docker概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-Docker%E4%B8%BA%E4%BB%80%E4%B9%88%E5%87%BA%E7%8E%B0"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 Docker为什么出现?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Docker%E7%9A%84%E5%8E%86%E5%8F%B2"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 Docker的历史</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Docker%E8%83%BD%E5%81%9A%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 Docker能做什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-DevOps-%E5%BC%80%E5%8F%91%E3%80%81%E8%BF%90%E7%BB%B4"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 DevOps(开发、运维)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">二、安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 Docker的基本组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%AE%89%E8%A3%85Docker"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 安装Docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 阿里云镜像加速</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 底层原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.</span> <span class="toc-text">三、Docker常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 帮助命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 镜像命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3%E3%80%81%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.3.</span> <span class="toc-text">3.3、容器命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4%E3%80%81%E5%B8%B8%E7%94%A8%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">3.4.</span> <span class="toc-text">3.4、常用其他命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-1-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8"><span class="toc-number">3.4.1.</span> <span class="toc-text">3.4.1 后台启动容器:</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-2-%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97"><span class="toc-number">3.4.2.</span> <span class="toc-text">3.4.2 查看日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-3-%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E4%B8%AD%E8%BF%9B%E7%A8%8B%E4%BF%A1%E6%81%AF-ps"><span class="toc-number">3.4.3.</span> <span class="toc-text">3.4.3 查看容器中进程信息 ps</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-4-%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F%E7%9A%84%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">3.4.4.</span> <span class="toc-text">3.4.4 查看镜像的元数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-5-%E8%BF%9B%E5%85%A5%E5%BD%93%E5%89%8D%E6%AD%A3%E5%9C%A8%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="toc-number">3.4.5.</span> <span class="toc-text">3.4.5 进入当前正在运行的容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-6-%E4%BB%8E%E5%AE%B9%E5%99%A8%E5%86%85%E6%8B%B7%E8%B4%9D%E5%88%B0%E4%B8%BB%E6%9C%BA%E4%B8%8A"><span class="toc-number">3.4.6.</span> <span class="toc-text">3.4.6 从容器内拷贝到主机上</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%B0%8F%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">四、小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E7%BB%83%E4%B9%A0"><span class="toc-number">5.</span> <span class="toc-text">五、练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1%E5%AE%89%E8%A3%85nginx"><span class="toc-number">5.1.</span> <span class="toc-text">5.1安装nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2%E5%AE%89%E8%A3%85tomcat"><span class="toc-number">5.2.</span> <span class="toc-text">5.2安装tomcat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3%E9%83%A8%E7%BD%B2es-kibana"><span class="toc-number">5.3.</span> <span class="toc-text">5.3部署es+kibana**</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-Docker%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 Docker可视化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81Docker%E9%95%9C%E5%83%8F%E8%AE%B2%E8%A7%A3"><span class="toc-number">6.</span> <span class="toc-text">六、Docker镜像讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E9%95%9C%E5%83%8F%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 镜像是什么?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-Docker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 Docker镜像加载原理?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-UnionFS%EF%BC%88%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%89%EF%BC%9A"><span class="toc-number">6.2.1.</span> <span class="toc-text">6.2.1 UnionFS（联合文件系统）：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2Dcoker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="toc-number">6.2.2.</span> <span class="toc-text">6.2.2Dcoker镜像加载原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3%E3%80%81%E5%88%86%E5%B1%82%E7%90%86%E8%A7%A3"><span class="toc-number">6.3.</span> <span class="toc-text">6.3、分层理解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-commit%E9%95%9C%E5%83%8F"><span class="toc-number">6.4.</span> <span class="toc-text">6.4 commit镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">7.</span> <span class="toc-text">七、容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%B9%E5%99%A8%E5%8D%B7%EF%BC%9F"><span class="toc-number">7.1.</span> <span class="toc-text">7.1 什么是容器卷？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">7.2.</span> <span class="toc-text">7.2 使用数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E5%AE%9E%E6%88%98%EF%BC%9A%E5%AE%89%E8%A3%85MySQL"><span class="toc-number">7.3.</span> <span class="toc-text">7.3 实战：安装MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E5%85%B7%E5%90%8D%E5%92%8C%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">7.4.</span> <span class="toc-text">7.4 具名和匿名挂载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-1-%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">7.4.1.</span> <span class="toc-text">7.4.1 匿名挂载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-2-%E5%85%B7%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">7.4.2.</span> <span class="toc-text">7.4.2 具名挂载</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-%E5%88%9D%E8%AF%86Dockerfile"><span class="toc-number">7.5.</span> <span class="toc-text">7.5 初识Dockerfile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">7.6.</span> <span class="toc-text">7.6 数据卷容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-7-%E5%A4%9A%E4%B8%AAmysql%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E5%85%B1%E4%BA%AB"><span class="toc-number">7.7.</span> <span class="toc-text">7.7 多个mysql实现数据共享</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81DockerFile"><span class="toc-number">8.</span> <span class="toc-text">八、DockerFile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-DockerFile%E4%BB%8B%E7%BB%8D"><span class="toc-number">8.1.</span> <span class="toc-text">8.1 DockerFile介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-DockerFile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">8.2.</span> <span class="toc-text">8.2 DockerFile构建过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-DockerFile%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">8.3.</span> <span class="toc-text">8.3 DockerFile常用指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-%E5%AE%9E%E6%88%98%E6%B5%8B%E8%AF%95-%E6%9E%84%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84centos"><span class="toc-number">8.4.</span> <span class="toc-text">8.4 实战测试 构建自己的centos</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-CMD-%E5%92%8C-ENTRYPOINT%E5%8C%BA%E5%88%AB"><span class="toc-number">8.5.</span> <span class="toc-text">8.5  CMD 和 ENTRYPOINT区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-%E5%AE%9E%E6%88%98%EF%BC%9Atomcat%E9%95%9C%E5%83%8F"><span class="toc-number">8.6.</span> <span class="toc-text">8.6 实战：tomcat镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-7-%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">8.7.</span> <span class="toc-text">8.7 发布自己的镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-8-%E5%8F%91%E5%B8%83%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1%E4%B8%8A"><span class="toc-number">8.8.</span> <span class="toc-text">8.8 发布阿里云镜像服务上</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-8%E3%80%81%E5%B0%8F%E7%BB%93"><span class="toc-number">8.9.</span> <span class="toc-text">8.8、小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81Docker%E7%BD%91%E7%BB%9C"><span class="toc-number">9.</span> <span class="toc-text">九、Docker网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E7%90%86%E8%A7%A3Docker0"><span class="toc-number">9.1.</span> <span class="toc-text">9.1 理解Docker0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E2%80%94link"><span class="toc-number">9.2.</span> <span class="toc-text">9.2    —link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="toc-number">9.3.</span> <span class="toc-text">9.3 自定义网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-5-Redis%E9%9B%86%E7%BE%A4%E5%AE%9E%E6%88%98%E9%83%A8%E7%BD%B2"><span class="toc-number">9.4.</span> <span class="toc-text">9.5 Redis集群实战部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-SpingBoot%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%89%93%E5%8C%85Docker%E9%95%9C%E5%83%8F"><span class="toc-number">9.5.</span> <span class="toc-text">9.6 SpingBoot微服务打包Docker镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-7-%E6%80%BB%E7%BB%93"><span class="toc-number">9.6.</span> <span class="toc-text">9.7 总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-%E8%AE%A4%E8%AF%86docker"><span class="toc-number">9.6.1.</span> <span class="toc-text">9.7.1 认识docker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-2-Docker%E5%AE%B9%E5%99%A8%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">9.6.2.</span> <span class="toc-text">9.7.2 Docker容器与虚拟机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-3-Docker-%E5%91%BD%E4%BB%A4"><span class="toc-number">9.6.3.</span> <span class="toc-text">9.7.3 Docker 命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-4%E3%80%81SpringBoot%E9%A1%B9%E7%9B%AE%E5%AE%B9%E5%99%A8%E5%8C%96%E6%AD%A5%E9%AA%A4"><span class="toc-number">9.6.4.</span> <span class="toc-text">9.7.4、SpringBoot项目容器化步骤</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/archives/29076.html" title="呆完成的hexo博客配置"><img src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/016.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="呆完成的hexo博客配置"/></a><div class="content"><a class="title" href="/archives/29076.html" title="呆完成的hexo博客配置">呆完成的hexo博客配置</a><time datetime="2022-03-05T15:59:15.000Z" title="发表于 2022-03-05 23:59:15">2022-03-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/10297.html" title="Docker最新超详细版教程通俗易懂(基础版)"><img src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/015.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker最新超详细版教程通俗易懂(基础版)"/></a><div class="content"><a class="title" href="/archives/10297.html" title="Docker最新超详细版教程通俗易懂(基础版)">Docker最新超详细版教程通俗易懂(基础版)</a><time datetime="2022-03-03T08:11:43.000Z" title="发表于 2022-03-03 16:11:43">2022-03-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/7478.html" title="SSH登录：WARNING REMOTE HOST IDENTIFICATION HAS CHANGED!"><img src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/007.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SSH登录：WARNING REMOTE HOST IDENTIFICATION HAS CHANGED!"/></a><div class="content"><a class="title" href="/archives/7478.html" title="SSH登录：WARNING REMOTE HOST IDENTIFICATION HAS CHANGED!">SSH登录：WARNING REMOTE HOST IDENTIFICATION HAS CHANGED!</a><time datetime="2022-02-25T11:33:27.000Z" title="发表于 2022-02-25 19:33:27">2022-02-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/54429.html" title="Nginx配置本地图片服务器"><img src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/015.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx配置本地图片服务器"/></a><div class="content"><a class="title" href="/archives/54429.html" title="Nginx配置本地图片服务器">Nginx配置本地图片服务器</a><time datetime="2022-02-23T14:11:03.000Z" title="发表于 2022-02-23 22:11:03">2022-02-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/archives/10872.html" title="【SpringBoot进阶】使用Docker Net部署项目（包含mysql,redis环境）.md"><img src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/007.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【SpringBoot进阶】使用Docker Net部署项目（包含mysql,redis环境）.md"/></a><div class="content"><a class="title" href="/archives/10872.html" title="【SpringBoot进阶】使用Docker Net部署项目（包含mysql,redis环境）.md">【SpringBoot进阶】使用Docker Net部署项目（包含mysql,redis环境）.md</a><time datetime="2022-02-23T14:10:38.000Z" title="发表于 2022-02-23 22:10:38">2022-02-23</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/015.webp')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 刘先森</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a href="icp链接"><img class="icp-icon"><span>备案号：xxxxxx</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.css"><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '2gDQ1XhIDLCU373i56XXhu4b-gzGzoHsz',
      appKey: 'CvuOgjrr4KnQpsnuwHfHvV1p',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: {"tv_doge":"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_親親":"a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_偷笑":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_再見":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_冷漠":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_發怒":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_發財":"34db290afd2963723c6eb3c4560667db7253a21a.png","tv_可愛":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_吐血":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_呆":"fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_嘔吐":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_困":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_壞笑":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_大佬":"093c1e2c490161aca397afc45573c877cdead616.png","tv_大哭":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_委屈":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_害羞":"a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_尷尬":"7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_微笑":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_思考":"90cf159733e558137ed20aa04d09964436f618a1.png","tv_驚嚇":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png"},
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/gh/HCLonely/Valine@latest/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=monsterid'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://2gDQ1XhI.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": '2gDQ1XhIDLCU373i56XXhu4b-gzGzoHsz',
        "X-LC-Key": 'CvuOgjrr4KnQpsnuwHfHvV1p',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><div class="aplayer no-destroy" data-id="1986659729" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><script defer src="/live2d-widget/autoload.js"></script><script async src="//at.alicdn.com/t/font_2264842_3izu8i5eoc2.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="https://npm.elemecdn.com/hexo-butterfly-clock/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_injector_config();
  }
  </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax src="https://npm.elemecdn.com/hexo-butterfly-clock/lib/clock.min.js"></script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="archives/60878.html" alt=""><img width="48" height="48" src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/014.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-07-25</span><a class="blog-slider__title" href="archives/60878.html" alt="">【Typora】github-与PicGO搭建图床</a><div class="blog-slider__text">点进去才能看到具体内容哦！</div><a class="blog-slider__button" href="archives/60878.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="archives/10297.html" alt=""><img width="48" height="48" src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/015.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-03-03</span><a class="blog-slider__title" href="archives/10297.html" alt="">Docker最新超详细版教程通俗易懂(基础版)</a><div class="blog-slider__text">点进去才能看到具体内容哦！</div><a class="blog-slider__button" href="archives/10297.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="archives/29076.html" alt=""><img width="48" height="48" src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/016.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-03-05</span><a class="blog-slider__title" href="archives/29076.html" alt="">呆完成的hexo博客配置</a><div class="blog-slider__text">呆完成的hexo博客配置</div><a class="blog-slider__button" href="archives/29076.html" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><div id="ghbdages" style="overflow:hidden;max-height:90px;height:auto;text-align:center;margin-top:10px"><div class="swiper-wrapper"><div class="swiper-slide"><a class="github-badge" target="_blank" href="https://hexo.io/" rel="external nofollow noreferrer" style="margin-inline:5px" title="博客框架为Hexo_v5.4.0"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" rel="external nofollow noreferrer" style="margin-inline:5px" title="主题版本Butterfly_v3.8.2"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" rel="external nofollow noreferrer" style="margin-inline:5px" title="本站使用JsDelivr为静态资源提供CDN加速"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr" alt=""/></a></div><div class="swiper-slide"><a class="github-badge" target="_blank" href="https://vercel.com/" rel="external nofollow noreferrer" style="margin-inline:5px" title="本站采用双线部署，默认线路托管于Vercel"><img src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" rel="external nofollow noreferrer" style="margin-inline:5px" title="本站采用双线部署，联通线路托管于Coding"><img src="https://img.shields.io/badge/Hosted-Coding-0cedbe?style=flat&amp;logo=Codio" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" rel="external nofollow noreferrer" style="margin-inline:5px" title="本站项目由Github托管"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a></div><div class="swiper-slide"><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" style="margin-inline:5px" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></div></div></div><style>a.github-badge:hover:before {display:none}</style>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-footer-beautify/lib/swiperbdage_init.min.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '1s');
    arr[i].setAttribute('data-wow-offset', '100');
    arr[i].setAttribute('data-wow-iteration', '2');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://unpkg.zhimg.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://unpkg.zhimg.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 280px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("https://gitcalendar.akilar.top/api?liuhuanhuan96",['#e4dfd7', '#f9f4dc', '#f7e8aa', '#f7e8aa', '#f8df72', '#fcd217', '#fcc515', '#f28e16', '#fb8b05', '#d85916', '#f43e06'],'liuhuanhuan96')
    }
  </script><!-- hexo injector body_end end --></body></html>